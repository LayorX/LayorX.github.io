<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5-4：夢的入口，百張床 - 《夢境時差：七封謎信》</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography,aspect-ratio,line-clamp"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">
    
    <meta name="theme-color" content="#f8fafc">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    
    <link rel="prev" href="chapter_chapter05-3.html">
    <link rel="next" href="chapter_chapter05-5.html">
    <style>
        :root {
            --font-sans: 'Inter', sans-serif;
            --font-serif: 'Noto Serif TC', serif;
            
            --bg-paper: #f8fafc; --text-paper: #334155; --border-paper: #e2e8f0; --link-paper: #475569; --active-bg-paper: #e2e8f0; --icon-fill-paper: #64748b;
            --bg-sepia: #f4f0e8; --text-sepia: #5f4b32; --border-sepia: #e9dec9; --link-sepia: #8a5a44; --active-bg-sepia: #e9dec9; --icon-fill-sepia: #5f4b32;
            --bg-night: #0f172a; --text-night: #94a3b8; --border-night: #334155; --link-night: #94a3b8; --active-bg-night: #1e293b; --icon-fill-night: #94a3b8;
        }

        .theme-paper { --bg-main: var(--bg-paper); --text-main: var(--text-paper); --border-main: var(--border-paper); --link-main: var(--link-paper); --active-bg-main: var(--active-bg-paper); --icon-fill: var(--icon-fill-paper); }
        .theme-sepia { --bg-main: var(--bg-sepia); --text-main: var(--text-sepia); --border-main: var(--border-sepia); --link-main: var(--link-sepia); --active-bg-main: var(--active-bg-sepia); --icon-fill: var(--icon-fill-sepia); }
        .theme-night { --bg-main: var(--bg-night); --text-main: var(--text-night); --border-main: var(--border-night); --link-main: var(--link-night); --active-bg-main: var(--active-bg-night); --icon-fill: var(--icon-fill-night); }
        
        body { font-family: var(--font-sans); background-color: var(--bg-main); color: var(--text-main); transition: background-color 0.4s ease, color 0.4s ease; }
        
        .prose { font-family: var(--font-serif); color: var(--text-main); transition: all 0.3s ease; }
        .prose p { font-size: 1.125rem; line-height: 2; letter-spacing: 0.05em; transition: font-size 0.3s ease, line-height 0.3s ease, letter-spacing 0.3s ease; }
        .prose h1, .prose h2, .prose h3 { font-family: var(--font-sans); color: var(--text-main); }
        
        .theme-switcher-btn svg, .setting-btn svg, #fullscreen-btn svg, .fab-btn svg { fill: var(--icon-fill); transition: fill 0.3s ease; }
        .theme-switcher-btn:hover svg, .setting-btn:hover svg, #fullscreen-btn:hover svg, .theme-switcher-btn.active svg, .fab-btn:hover svg { fill: var(--text-main); }

        .nav-btn { font-family: var(--font-sans); color: var(--link-main); padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.3s, color 0.3s; font-weight: 500; }
        .nav-btn:hover { background-color: var(--active-bg-main); color: var(--text-main); }

        #sidebar, #menu, #content-container { scrollbar-width: thin; scrollbar-color: var(--border-main) transparent; }
        #sidebar::-webkit-scrollbar, #menu::-webkit-scrollbar, #content-container::-webkit-scrollbar { width: 5px; }
        #sidebar::-webkit-scrollbar-track, #menu::-webkit-scrollbar-track, #content-container::-webkit-scrollbar-track { background: transparent; }
        #sidebar::-webkit-scrollbar-thumb, #menu::-webkit-scrollbar-thumb, #content-container::-webkit-scrollbar-thumb { background-color: var(--border-main); border-radius: 20px; }

        #sidebar { transition: margin-left 0.3s ease-in-out; }
        .sidebar-collapsed #sidebar { margin-left: -18rem; }
        @media (min-width: 1024px) { .sidebar-collapsed #sidebar { margin-left: -20rem; } }
        
        .sub-nav-container { max-height: 1000px; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        .sub-nav-container.hidden { max-height: 0; }
        
        .font-size-sm .prose p { font-size: 1rem; }
        .font-size-md .prose p { font-size: 1.125rem; }
        .font-size-lg .prose p { font-size: 1.25rem; }

        .font-family-serif .prose { font-family: var(--font-serif); }
        .font-family-sans .prose { font-family: var(--font-sans); }
        .font-family-sans .prose p { letter-spacing: 0.025em; }

        .line-height-tight .prose p { line-height: 1.7; }
        .line-height-normal .prose p { line-height: 2; }
        .line-height-loose .prose p { line-height: 2.3; }

        .letter-spacing-tight .prose p { letter-spacing: 0.025em; }
        .letter-spacing-normal .prose p { letter-spacing: 0.05em; }
        .letter-spacing-loose .prose p { letter-spacing: 0.075em; }

        .page-margin-narrow .prose { max-width: 48rem; }
        .page-margin-normal .prose { max-width: 42rem; }
        .page-margin-wide .prose { max-width: 36rem; }

        .setting-option-btn { flex-grow: 1; text-align: center; padding: 4px 8px; border-radius: 999px; font-size: 0.875rem; background-color: transparent; border: 1px solid var(--border-main); color: var(--link-main); transition: all 0.2s; } 
        .setting-option-btn:not(:last-child) { margin-right: 4px; } 
        .setting-option-btn.active, .setting-option-btn:hover { background-color: var(--active-bg-main); color: var(--text-main); border-color: var(--link-main); }
    </style>
</head>
<body class="theme-paper font-size-md font-family-serif line-height-normal letter-spacing-normal page-margin-normal" data-novel-id="dream-jetlag">

    <div id="progress-bar-container" class="fixed top-0 left-0 w-full h-1 z-20">
        <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-150" style="width: 0%;"></div>
    </div>

    <div id="app-container" class="flex h-screen bg-[var(--bg-main)] overflow-hidden">
        <aside id="sidebar" class="hidden md:flex flex-col w-72 lg:w-80 bg-transparent border-r border-[var(--border-main)] flex-shrink-0">
            <div class="p-4 border-b border-[var(--border-main)] flex-shrink-0">
                <a href="../index.html" class="flex items-center gap-2 text-[var(--link-main)] hover:text-[var(--text-main)] transition-colors duration-300 font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                    返回書庫
                </a>
            </div>
            <div class="p-4 border-b border-[var(--border-main)]">
                <input type="search" id="desktop-chapter-search" placeholder="搜尋章節..." class="w-full px-3 py-2 text-sm bg-transparent border border-[var(--border-main)] rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-[var(--text-main)] placeholder-[var(--link-main)]">
            </div>
            <div id="desktop-chapter-list-container" class="flex-1 p-4 overflow-y-auto">
                <div class="aspect-w-3 aspect-h-4 mb-4"><img src="cover.jpg" alt="《夢境時差：七封謎信》 封面" class="w-full h-full object-cover rounded-lg shadow-md"></div>
                <h2 class="text-xl font-bold mb-4 text-[var(--text-main)]">《夢境時差：七封謎信》</h2>
                <nav id="chapter-list">
                    <a href="chapter_chapter00.html" class="chapter-link block p-3 rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">📖序章：《哇哇哇！奇人異事！》啟動！</a><div class="chapter-group"><div class="chapter-toggle-btn flex justify-between items-center rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)] "><a href="chapter_chapter01.html" class="chapter-link flex-grow p-3">📖第一章：《他在夢裡學完了 MIT 四年課程》夢創協同！</a><button data-toggle-target="sub-nav-chapter_chapter01-html" class="chevron-btn flex-shrink-0 p-3" aria-expanded="false"><svg class="chevron-icon w-4 h-4 transition-transform duration-200 " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button></div><div id="sub-nav-chapter_chapter01-html" class="sub-nav-container mt-1 space-y-1 border-l-2 border-[var(--border-main)] pl-3 ml-4 hidden"><a href="chapter_chapter01-1.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">1-1：【哇哇哇！奇人異事！】夢創協同 Ep1</a><a href="chapter_chapter01-2.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">1-2：第一封信</a></div></div><div class="chapter-group"><div class="chapter-toggle-btn flex justify-between items-center rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)] "><a href="chapter_chapter02.html" class="chapter-link flex-grow p-3">📖第二章：《更大的流量，更大的危險》留言!</a><button data-toggle-target="sub-nav-chapter_chapter02-html" class="chevron-btn flex-shrink-0 p-3" aria-expanded="false"><svg class="chevron-icon w-4 h-4 transition-transform duration-200 " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button></div><div id="sub-nav-chapter_chapter02-html" class="sub-nav-container mt-1 space-y-1 border-l-2 border-[var(--border-main)] pl-3 ml-4 hidden"><a href="chapter_chapter02-1.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">2-1：深海巨怪</a><a href="chapter_chapter02-2.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">2-2 蜂擁而至</a></div></div><div class="chapter-group"><div class="chapter-toggle-btn flex justify-between items-center rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)] "><a href="chapter_chapter03.html" class="chapter-link flex-grow p-3">📖第三章：《輿論的漩渦，夢境的加密》託夢！</a><button data-toggle-target="sub-nav-chapter_chapter03-html" class="chevron-btn flex-shrink-0 p-3" aria-expanded="false"><svg class="chevron-icon w-4 h-4 transition-transform duration-200 " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button></div><div id="sub-nav-chapter_chapter03-html" class="sub-nav-container mt-1 space-y-1 border-l-2 border-[var(--border-main)] pl-3 ml-4 hidden"><a href="chapter_chapter03-1.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">3-1：發燒影片</a><a href="chapter_chapter03-2.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">3-2：夢創協同 Ep2 - 第一個證據</a><a href="chapter_chapter03-3.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">3-3：黑書卷軸</a><a href="chapter_chapter03-4.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">3-4：旁觀者</a></div></div><div class="chapter-group"><div class="chapter-toggle-btn flex justify-between items-center rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)] "><a href="chapter_chapter04.html" class="chapter-link flex-grow p-3">📖第四章：《預言者的回聲，與瘋狂的啟動！》</a><button data-toggle-target="sub-nav-chapter_chapter04-html" class="chevron-btn flex-shrink-0 p-3" aria-expanded="false"><svg class="chevron-icon w-4 h-4 transition-transform duration-200 " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button></div><div id="sub-nav-chapter_chapter04-html" class="sub-nav-container mt-1 space-y-1 border-l-2 border-[var(--border-main)] pl-3 ml-4 hidden"><a href="chapter_chapter04-1.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">4-1：煎熬的等待</a><a href="chapter_chapter04-2.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">4-2：夢創協同 Ep3 - 預言者的回聲</a><a href="chapter_chapter04-3.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">4-3： D.I.R.E</a><a href="chapter_chapter04-4.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">4-4：三發預言</a></div></div><div class="chapter-group"><div class="chapter-toggle-btn flex justify-between items-center rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)] "><a href="chapter_chapter05.html" class="chapter-link flex-grow p-3">📖第五章：《當信眾狂熱！信任的裂痕！》</a><button data-toggle-target="sub-nav-chapter_chapter05-html" class="chevron-btn flex-shrink-0 p-3" aria-expanded="true"><svg class="chevron-icon w-4 h-4 transition-transform duration-200 rotate-90" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button></div><div id="sub-nav-chapter_chapter05-html" class="sub-nav-container mt-1 space-y-1 border-l-2 border-[var(--border-main)] pl-3 ml-4 "><a href="chapter_chapter05-1.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">5-1：當預言成真，恐懼才真正開始。</a><a href="chapter_chapter05-2.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">5-2：數位狩獵：當訊息成為武器</a><a href="chapter_chapter05-3.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">5-3：沉默的代價，如果我不是我</a><a href="chapter_chapter05-4.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 bg-[var(--active-bg-main)] font-bold text-[var(--text-main)]">5-4：夢的入口，百張床</a><a href="chapter_chapter05-5.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">5-5：先鋒夢協者:狸、熊、兔、鴉</a><a href="chapter_chapter05-6.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">5-6：雙重連夢：在夢中抵達進階</a></div></div><div class="chapter-group"><div class="chapter-toggle-btn flex justify-between items-center rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)] "><a href="chapter_chapter06.html" class="chapter-link flex-grow p-3">📖第六章：《師爺駕到，全員撤退！》</a><button data-toggle-target="sub-nav-chapter_chapter06-html" class="chevron-btn flex-shrink-0 p-3" aria-expanded="false"><svg class="chevron-icon w-4 h-4 transition-transform duration-200 " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button></div><div id="sub-nav-chapter_chapter06-html" class="sub-nav-container mt-1 space-y-1 border-l-2 border-[var(--border-main)] pl-3 ml-4 hidden"><a href="chapter_chapter06-1.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-1：師爺的現身</a><a href="chapter_chapter06-2.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-2：第四封信</a><a href="chapter_chapter06-3.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-3：可樂味的夢境試煉</a><a href="chapter_chapter06-4.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-4：O的孤軍奮戰</a><a href="chapter_chapter06-5.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-5：計畫代號：FLASH</a><a href="chapter_chapter06-6.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-6：休門與生門</a><a href="chapter_chapter06-7.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-7：FLASH！</a><a href="chapter_chapter06-8.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-8 ：首爾封鎖，夢境餘波</a><a href="chapter_chapter06-9.html" class="chapter-link block p-2 rounded-md text-sm hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">6-9：四號安全屋</a></div></div><a href="letter_letter1.html" class="chapter-link block p-3 rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">✉️ 第一封信《他在夢裡學完了 MIT 四年課程》</a><a href="letter_letter2.html" class="chapter-link block p-3 rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">✉️ 第二封信《來自夢境的加密訊息》</a><a href="letter_letter3.html" class="chapter-link block p-3 rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">✉️ 第二封信《預言的迴響》</a><a href="letter_letter4.html" class="chapter-link block p-3 rounded-md hover:bg-[var(--active-bg-main)] transition-colors duration-200 text-[var(--link-main)]">✉️ 第四封信《夢境的矛與盾》</a>
                </nav>
            </div>
        </aside>
        
        <main class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-transparent p-4 flex justify-between items-center z-10 flex-shrink-0">
                <div class="flex items-center gap-2">
                    <button id="sidebar-toggle-btn" class="hidden md:block p-2 rounded-full hover:bg-[var(--active-bg-main)]" title="收合/展開目錄">
                        <svg id="sidebar-toggle-icon" class="w-6 h-6 text-[var(--icon-fill)] transition-transform duration-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg>
                    </button>
                    <button id="menu-btn" class="md:hidden p-2 rounded-full hover:bg-[var(--active-bg-main)] text-[var(--text-main)] cursor-pointer transition-colors" aria-expanded="false">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="var(--icon-fill)"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg>
                    </button>
                </div>
                <div class="flex items-center text-center">
                    <h1 class="text-base font-medium text-[var(--text-main)] opacity-70 truncate mx-4">5-4：夢的入口，百張床</h1>
                    <span id="progress-percent" class="text-sm font-mono text-[var(--icon-fill)] w-12 text-left">0%</span>
                </div>
                <!-- 【修改】移除設定按鈕，只留下桌面版的功能按鈕 -->
                <div class="flex items-center space-x-1">
                    <div class="hidden md:flex items-center space-x-1">
                        <button id="fullscreen-btn" class="p-2 rounded-full hover:bg-[var(--active-bg-main)] transition-colors" title="全螢幕">
                            <svg id="fullscreen-enter-icon" class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v3A1.5 1.5 0 004.5 8h3A1.5 1.5 0 009 6.5v-3A1.5 1.5 0 007.5 2h-3zM3 13.5A1.5 1.5 0 014.5 12h3a1.5 1.5 0 011.5 1.5v3A1.5 1.5 0 017.5 18h-3A1.5 1.5 0 013 16.5v-3zM12 3.5A1.5 1.5 0 0113.5 2h3A1.5 1.5 0 0118 3.5v3A1.5 1.5 0 0116.5 8h-3A1.5 1.5 0 0112 6.5v-3zM13.5 12A1.5 1.5 0 0012 13.5v3a1.5 1.5 0 001.5 1.5h3a1.5 1.5 0 001.5-1.5v-3A1.5 1.5 0 0016.5 12h-3z" clip-rule="evenodd" /></svg>
                            <svg id="fullscreen-exit-icon" class="w-5 h-5 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 5.5A1.5 1.5 0 013.5 4h3A1.5 1.5 0 018 5.5v3A1.5 1.5 0 016.5 10h-3A1.5 1.5 0 012 8.5v-3zM12 5.5A1.5 1.5 0 0113.5 4h3A1.5 1.5 0 0118 5.5v3a1.5 1.5 0 01-1.5 1.5h-3A1.5 1.5 0 0112 8.5v-3zM3.5 12A1.5 1.5 0 002 13.5v3A1.5 1.5 0 003.5 18h3A1.5 1.5 0 008 16.5v-3A1.5 1.5 0 006.5 12h-3zM13.5 12a1.5 1.5 0 00-1.5 1.5v3a1.5 1.5 0 001.5 1.5h3a1.5 1.5 0 001.5-1.5v-3a1.5 1.5 0 00-1.5-1.5h-3z" clip-rule="evenodd" /></svg>
                        </button>
                        <button data-theme="paper" class="theme-switcher-btn p-2 rounded-full hover:bg-[var(--active-bg-main)] transition-colors" title="日間模式"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.02-.39-1.41 0l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.42-1.42c.39-.39.39-1.02 0-1.41zm13.42 13.42c-.39-.39-1.02-.39-1.41 0l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.42-1.42c.39-.39.39-1.02 0-1.41zM20.42 5.99c.39-.39.39-1.02 0-1.41l-1.42-1.42c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.42 1.42c.39.39 1.02.39 1.41 0zM4.58 19.41c.39-.39.39-1.02 0-1.41l-1.42-1.42c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.42 1.42c.39.39 1.02.39 1.41 0z"/></svg></button>
                        <button data-theme="sepia" class="theme-switcher-btn p-2 rounded-full hover:bg-[var(--active-bg-main)] transition-colors" title="懷舊模式"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5z"/></svg></button>
                        <button data-theme="night" class="theme-switcher-btn p-2 rounded-full hover:bg-[var(--active-bg-main)] transition-colors" title="夜間模式"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.64-.11 2.4-.31-.3-.13-.59-.29-.87-.48-.69-.48-1.29-1.12-1.72-1.85C11.23 17.5 11 16.78 11 16c0-2.21 1.79-4 4-4 .78 0 1.5.23 2.15.62.73.43 1.37 1.03 1.85 1.72.19.28.35.57.48.87.2-.76.31-1.57.31-2.4 0-4.97-4.03-9-9-9z"/></svg></button>
                    </div>
                </div>
            </header>
            
            <div id="content-container" class="flex-1 relative overflow-y-auto">
                <div id="menu" class="md:hidden fixed inset-0 bg-[var(--bg-main)] p-0 w-72 h-full shadow-lg transition-transform duration-300 ease-in-out transform -translate-x-full z-30 flex flex-col">
                    <div class="p-4 border-b border-[var(--border-main)] flex-shrink-0">
                         <a href="../index.html" class="flex items-center gap-2 text-[var(--link-main)] hover:text-[var(--text-main)] transition-colors duration-300 font-medium">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                            返回書庫
                        </a>
                    </div>
                    <div class="p-4 border-b border-[var(--border-main)]">
                         <input type="search" id="mobile-chapter-search" placeholder="搜尋章節..." class="w-full px-3 py-2 text-sm bg-transparent border border-[var(--border-main)] rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-[var(--text-main)] placeholder-[var(--link-main)]">
                    </div>
                    <div id="mobile-chapter-list-container" class="flex-1 p-4 overflow-y-auto">
                        <h2 class="text-xl font-bold mb-4 text-[var(--text-main)]">《夢境時差：七封謎信》</h2>
                        <nav id="mobile-chapter-list"></nav>
                    </div>
                </div>
                <div id="menu-overlay" class="md:hidden fixed inset-0 bg-black bg-opacity-25 z-20 opacity-0 pointer-events-none transition-opacity duration-300 cursor-pointer"></div>

                <article id="content-area" class="p-6 md:p-12 prose max-w-2xl mx-auto">
                    <h1 class="text-3xl md:text-4xl font-bold mb-2 !text-[var(--text-main)] text-center">5-4：夢的入口，百張床</h1>
                    <p class="text-lg italic text-[var(--text-main)] opacity-75 mt-2 mb-10 text-center font-serif"># 我們是先知，還是被利用的工具？</p>
                    <p class="mb-6 leading-loose tracking-wide">【飛往南韓的飛機・深夜】</p><p class="mb-6 leading-loose tracking-wide">機艙內，引擎的轟鳴聲低沉而規律，像是為老度催眠的搖籃曲。他的身體陷在狹窄的經濟艙座位裡，精神卻早已不堪重負。過去幾天的輿論風暴、老K的背叛，以及最後那段詭異的AI語音，像一團無形的亂麻，緊緊勒住他的心臟。他不知道自己是什麼時候入睡的，只知道疲憊如潮水般湧來，將他拉入一片漆黑的深海。</p><p class="mb-6 leading-loose tracking-wide">在深層睡眠中，他的意識並未完全關閉。一陣強烈的眩暈感襲來，彷彿整個世界都在急速膨脹與收縮。周遭的景象開始變得五顏六色，光影扭曲，雲霧不斷纏繞、遮蔽著視線。他感到頭腦一陣昏眩，緊接著，眼前的一切都化為純粹的黑暗。</p><p class="mb-6 leading-loose tracking-wide">當他再次睜開眼，自己正身處一個完全陌生的空間。地面是平整的純白，天花板和牆壁則是一片無垠的藍天，白雲悠然飄過，構成一個超現實的潔淨世界。</p><p class="mb-6 leading-loose tracking-wide">在他的面前，一個約莫二十出頭的少年，戴著一頂破舊的黑藍棒球帽，帽簷壓得很低，遮住了大半張臉。他穿著一件灰色連帽T恤，搭配卡其工裝褲，雖然帶著眼鏡但眼神卻異常明亮而沉穩。他的臉上帶著一抹熟悉的笑意，眼神帶有一種超越年齡的淡定與智慧。</p><p class="mb-6 leading-loose tracking-wide">老度心跳驟停，腦袋飛速運轉，將眼前的一切與過去的資訊串聯起來：夢境、二十出頭的少年、RR。</p><p class="mb-6 leading-loose tracking-wide">「……阿爾？不對，RR？」他驚訝地開口。</p><p class="mb-6 leading-loose tracking-wide">少年笑了，笑聲清澈而短促。「終於見面了，千辛萬苦。」他將帽簷往上推了一點，露出那雙深邃的眼睛，「果然，用這種方法有效。」</p><p class="mb-6 leading-loose tracking-wide">老度猛然想起登機前收到的那封匿名簡訊，以及自己腦海中不斷回想著大學時期第一次與老K碰面的畫面。那是一種出於本能的，對失落友情的追憶。</p><p class="mb-6 leading-loose tracking-wide">「時間不多了，直接進入重點吧。」少年收起笑容，語氣變得嚴肅而高效。「雖然在夢裡，我們能有很多時間，但這是你第一次進入『夢創協同』狀態，而且我是用『連夢』方式把你強制帶進來的。這能確保你能帶著記憶和經驗回去。這是一種加速開啟夢協能力的方法，但因人而異，而且第一次連夢，我也不確定能跟你連多久。」</p><p class="mb-6 leading-loose tracking-wide">他邊說邊揮了揮手，周圍的藍天白雲瞬間變成一個巨大的數位時鐘。</p><p class="mb-6 leading-loose tracking-wide">「我目前的夢境加速時間大概是八百倍。到韓國大概還有兩小時，扣除進入與不穩定的後期狀態，實際連線時間大概三十分鐘。」少年指著時鐘上的數字，輕聲說道：「也就是說，我們有三百多個小時，半個月以上的時間。這對於訓練你來說不太夠，所以我們得加把勁。」</p><p class="mb-6 leading-loose tracking-wide">老度聽得有些發愣，但他的工程師思維立刻接管了混亂的情緒。這聽起來像是一個精心設計的學習程式。他平靜下來，專注地聽著RR的解釋。</p><p class="mb-6 leading-loose tracking-wide">「首先，要成為『低階夢協者』，就是要能非常專注在一件事情上，近乎癡狂地想。這件事每次睡前都思考，想著它入睡，就會大機率增加進入這個狀態。而這個『想的事情』，就是我們稱之為『夢口』的入口。」RR解釋道，「每個夢協者的夢口都不一樣，數量也不同，能有越多夢口越好，就能增加進入夢協狀態的機率。因為如O所說，百分之九十五以上的夢協者都沒辦法隨時自然地進入。」</p><p class="mb-6 leading-loose tracking-wide">「低階夢協者帶回來的是記憶想法，初階是經驗能力，進階則能影響他人：託夢（傳遞訊息）、連夢（帶人一起進入你的夢協狀態，對方也能帶回經驗）、夢實（實際把夢裡的想像實現）。但這些能力都需要知道對方的夢口。連夢還要對方也進入夢協狀態，這也是為什麼我要讓你透過回憶老K而入睡，這樣才能讓我有機會跟你連線。」</p><p class="mb-6 leading-loose tracking-wide">老度靜靜地聽著，心中的迷惑慢慢被資訊填補。</p><p class="mb-6 leading-loose tracking-wide">「那要怎麼預防或防禦對方的託夢攻擊呢？」少年輕笑一聲，又恢復了一絲隨性。「第一點，就是每天想的夢口都不一樣。你可以想像每個夢口都會有專門的守衛，你擁有的夢口越多，守護你的記憶和思想的人就越多。」</p><p class="mb-6 leading-loose tracking-wide">老度一邊聽，一邊環顧四周。空間雖虛幻卻異常清晰，光源無明顯來源，地面如同細緻水泥面，無邊無際。他感覺不到風，卻感受到自己每一次呼吸的密度。</p><p class="mb-6 leading-loose tracking-wide">「這就是你掌控的夢？」他低聲問。</p><p class="mb-6 leading-loose tracking-wide">「因為你現在在我的夢協裡，我已經練到可以隨意操控這個夢境狀態了。如果是你目前的狀態，你只能在你與老K相遇的那個夢境練習，情境也會受限。」</p><p class="mb-6 leading-loose tracking-wide">少年再次揮手，整個實驗室畫面瞬間瓦解，取而代之的是一個巨大的白色房間，裡面擺放着幾十張一模一樣的床。</p><p class="mb-6 leading-loose tracking-wide">「反正現在我這個夢境，是專門讓你練習製造夢口。」</p><p class="mb-6 leading-loose tracking-wide">「那老K……他的夢口是什麼？」</p><p class="mb-6 leading-loose tracking-wide">「他只有三個，」語氣有些惋惜，「他想像力、執念強，但不穩定。他缺乏多樣性的進入點，所以防禦力差。」</p><p class="mb-6 leading-loose tracking-wide">少年拿下帽子，隨手一揮，床的數量瞬間增加到上百張。「你現在就躺在上面，努力想某個能讓你專注、進入情緒的畫面。想到入魔那種，很想很想那種。達到條件，床就會自動瓦解坍陷，你就可以換另一張床。現在這個是很辛苦的，但沒辦法，你得加緊腳步。老K就是只成功讓三張床消失，造成後面夢境防禦不足。」</p><p class="mb-6 leading-loose tracking-wide">老度沒有多問，他的工程師本能讓他立刻理解了這個遊戲的規則。他躺在一張床上，開始回想。</p><p class="mb-6 leading-loose tracking-wide">他回想著第一次寫出成功運行的程式碼時，那種純粹的、無法言喻的成就感；回想著與老K第一次合作，熬夜趕出一個影片腳本時的興奮；回想著他對資訊安全最底層邏輯的執著與探究。這些都是他生命中「近乎癡狂」的時刻。</p><p class="mb-6 leading-loose tracking-wide">一張床，兩張床，三張床……當他的思緒達到某種極致的專注與情感時，床底下的光線就會閃爍，然後瞬間瓦解，化為碎片消失。</p><p class="mb-6 leading-loose tracking-wide">時間在夢境中飛速流逝，老度不斷地在一百多張床之間切換。他挑戰自己的記憶、情感與專注力。這是他一生中從未有過的訓練，但每當他感到疲憊時，腦海中就會閃過老K那張熱情又天真的臉。</p><p class="mb-6 leading-loose tracking-wide">【第7天】</p><p class="mb-6 leading-loose tracking-wide">最後一張床轟然瓦解，光芒爆散之際，少年站在一旁笑了：「O果然沒選錯人，比我都快呢，果然還是知識分子有這種潛力！」少年忍不住讚嘆，語氣中充滿了敬佩。</p><p class="mb-6 leading-loose tracking-wide">老度擦了擦額頭的汗，雖然夢中不會真正疲憊，但那種持續用腦的壓力幾乎讓他精神麻木。</p><p class="mb-6 leading-loose tracking-wide">老度從最後一張瓦解的床上起身，他眼神充滿鬥志，沒有一絲疲憊。「可以告訴我老K的情況了嗎？」他開口，聲音平靜但充滿決心。</p><p class="mb-6 leading-loose tracking-wide">「還有，我要怎麼確定我下次進入可以到初階狀態，而不是低階？是要練習記憶力嗎？練習把夢裡的東西都記住？」</p><p class="mb-6 leading-loose tracking-wide">少年露出驚訝的神情。「你真的很聰明！」他走到老度面前，輕輕拍了拍他的肩膀。「沒錯，下一個階段就是練習記憶力。不過這個東西是下一次練習的，因為人在快醒來、夢境結束前，最容易記住夢裡的東西。」</p><p class="mb-6 leading-loose tracking-wide">「以短眠睡眠法聞名的愛迪生就是為了抓住夢境碎片。但我們現在還不能讓你起來。那是之後你可以練習的——當你知道自己進入夢協狀態，想辦法讓自己起來記住，然後再趕快睡覺進入，反覆地，有點像是賴床跟回籠覺的概念。」</p><p class="mb-6 leading-loose tracking-wide">「總之，現在我們要來練習偵查與反偵察的東西。」少年雙手合十，輕輕一拍，發出「啪」的一聲。</p><p class="mb-6 leading-loose tracking-wide">周圍的白色空間瞬間變換，他們來到了一個充滿高科技感的特警資訊站裡。螢幕上閃爍著各種數據，牆上貼滿了嫌疑人的照片與線索。</p><p class="mb-6 leading-loose tracking-wide">「你接下來要先看這些影片跟書，我想有很多你之前有學過，不過這裡有更多東西要學。因為到時候到韓國很多人會找你，要先想辦法找到我們會合。中間很多基本技巧跟一些防身的方法都要練習。七天多應該夠你學。加油，老度。」</p><p class="mb-6 leading-loose tracking-wide">少年轉身，一扇光門出現在他面前。他戴上帽子，微微一笑：「我去外面練習我的能力了。」說完，他便進入了光門，消失不見。</p><p class="mb-6 leading-loose tracking-wide">老度看著少年消失，周遭的螢幕、書籍與資料都變得異常真實。他知道，這不是一個單純的夢，而是一場來自未來的、跨越時空的「特訓」。</p><p class="mb-6 leading-loose tracking-wide">【仁川機場・清晨】</p><p class="mb-6 leading-loose tracking-wide">飛機降落，巨大的震動將老度從夢境中拉回現實。他猛地睜開眼，心臟狂跳。</p><p class="mb-6 leading-loose tracking-wide">「呼...」他長長地吐出一口氣，發現機艙內的空氣悶熱而乾燥，充斥著混雜的氣味。周圍乘客的臉龐在昏暗的燈光下模糊不清，有人輕聲打著鼾，有人正慵懶地伸展著身體。這與夢境中那潔淨、純粹的世界形成了強烈的對比。</p><p class="mb-6 leading-loose tracking-wide">他還記得夢中的一切：藍天白雲、上百張床、特警資訊站… 以及RR那張二十出頭的臉。夢中的時間感強烈而真實，但當他看向手錶時，才發現只過了兩個小時。</p><p class="mb-6 leading-loose tracking-wide">他走出機艙，呼吸著南韓清晨冰冷的空氣。他打開手機，螢幕上赫然出現一條來自匿名號碼的加密簡訊：</p><p class="mb-6 leading-loose tracking-wide">「出口五，黑色的棒球帽，別回頭。」</p><p class="mb-6 leading-loose tracking-wide">他心中一凜。這與夢境中的少年何其相似。老度沒有多想，直接朝著五號出口走去。</p><p class="mb-6 leading-loose tracking-wide">在出口處，他看到一個年輕的女子，她穿著一件黑色的羽絨外套，頭戴一頂黑色的棒球帽，低著頭看著手機，沒有注意到他。</p><p class="mb-6 leading-loose tracking-wide">老度沒有回頭，只是輕輕地從她身邊走過。當他與她擦肩而過時，女子的手機屏幕突然亮起，上面出現一行字：</p><p class="mb-6 leading-loose tracking-wide">「跟上。」</p><p class="mb-6 leading-loose tracking-wide">老度心中一動，知道自己找對人了。他跟著女子走出了機場，搭上一輛計程車，朝著未知的旅程駛去。</p><p class="mb-6 leading-loose tracking-wide">---</p>
                    <div class="flex justify-between mt-12 pt-6 border-t border-[var(--border-main)]"><a href="chapter_chapter05-3.html" id="prev-page-link" class="nav-btn">← 上一節</a><a href="chapter_chapter05-5.html" id="next-page-link" class="nav-btn">下一節 →</a></div>
                </article>
            </div>
        </main>
    </div>

    <!-- 【修改】將設定按鈕與面板移至此處 -->
    <div class="fixed bottom-6 right-6 z-20 flex flex-col items-end gap-3">
        <!-- 設定按鈕與面板的容器 -->
        <div class="relative">
            <!-- 設定面板 -->
            <div id="setting-panel" class="hidden absolute bottom-full right-0 mb-2 w-72 bg-[var(--bg-main)] rounded-lg shadow-lg border border-[var(--border-main)] p-4" role="menu">
                <div class="space-y-4">
                    <div class="md:hidden">
                        <label class="block text-sm font-medium text-[var(--text-main)] mb-2">顯示</label>
                        <div class="flex justify-between items-center">
                            <button data-action="fullscreen" class="setting-option-btn w-full">全螢幕</button>
                        </div>
                    </div>
                    <div class="md:hidden">
                        <label class="block text-sm font-medium text-[var(--text-main)] mb-2">主題</label>
                        <div class="flex justify-between items-center">
                            <button data-theme="paper" class="setting-option-btn theme-switcher-btn">日間</button>
                            <button data-theme="sepia" class="setting-option-btn theme-switcher-btn">懷舊</button>
                            <button data-theme="night" class="setting-option-btn theme-switcher-btn">夜間</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-x-4 gap-y-4">
                        <div>
                            <label class="block text-sm font-medium text-[var(--text-main)] mb-2">字體大小</label>
                            <div class="flex justify-between items-center">
                                <button data-action="set-font-size" data-value="sm" class="setting-option-btn">小</button>
                                <button data-action="set-font-size" data-value="md" class="setting-option-btn">中</button>
                                <button data-action="set-font-size" data-value="lg" class="setting-option-btn">大</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[var(--text-main)] mb-2">字體風格</label>
                            <div class="flex justify-between items-center">
                                <button data-action="set-font-family" data-value="serif" class="setting-option-btn">襯線</button>
                                <button data-action="set-font-family" data-value="sans" class="setting-option-btn">非襯線</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[var(--text-main)] mb-2">行高</label>
                            <div class="flex justify-between items-center">
                                <button data-action="set-line-height" data-value="tight" class="setting-option-btn">緊湊</button>
                                <button data-action="set-line-height" data-value="normal" class="setting-option-btn">標準</button>
                                <button data-action="set-line-height" data-value="loose" class="setting-option-btn">寬鬆</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[var(--text-main)] mb-2">字距</label>
                            <div class="flex justify-between items-center">
                                <button data-action="set-letter-spacing" data-value="tight" class="setting-option-btn">緊湊</button>
                                <button data-action="set-letter-spacing" data-value="normal" class="setting-option-btn">標準</button>
                                <button data-action="set-letter-spacing" data-value="loose" class="setting-option-btn">寬鬆</button>
                            </div>
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-[var(--text-main)] mb-2">頁面邊距</label>
                            <div class="flex justify-between items-center">
                                <button data-action="set-page-margin" data-value="narrow" class="setting-option-btn">窄</button>
                                <button data-action="set-page-margin" data-value="normal" class="setting-option-btn">中</button>
                                <button data-action="set-page-margin" data-value="wide" class="setting-option-btn">寬</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-[var(--border-main)]">
                    <label for="remember-position-toggle" class="flex justify-between items-center cursor-pointer">
                        <span class="text-sm font-medium text-[var(--text-main)]">記住閱讀位置</span>
                        <div class="relative">
                            <input type="checkbox" id="remember-position-toggle" class="sr-only peer">
                            <div class="w-10 h-6 bg-slate-300 rounded-full peer-checked:bg-blue-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                        </div>
                    </label>
                </div>
            </div>
            <!-- 懸浮設定按鈕 -->
            <button id="setting-toggle-btn" class="fab-btn" title="閱讀設定" aria-haspopup="true" aria-expanded="false">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z" /></svg>
            </button>
        </div>
        
        <!-- 其他懸浮按鈕 -->
        <button id="scroll-to-top" class="fab-btn hidden" title="回到頂部">
            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l-8 8h5v8h6v-8h5l-8-8z"/></svg>
        </button>
        <button id="scroll-to-bottom" class="fab-btn" title="前往底部">
            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 20l8-8h-5V4h-6v8H4l8 8z"/></svg>
        </button>
    </div>
    <style>.fab-btn { background-color: var(--active-bg-main); color: var(--icon-fill); width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s ease; } .fab-btn:hover { transform: scale(1.1); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }</style>
    
    <div id="last-read-toast" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 bg-[var(--bg-main)] text-[var(--text-main)] px-6 py-3 rounded-lg shadow-xl border border-[var(--border-main)] z-30 flex items-center gap-4">
        <p class="text-sm">要跳轉至上次閱讀的位置嗎？</p>
        <a id="last-read-link" href="#" class="font-bold text-blue-500 text-sm hover:underline">跳轉</a>
        <button id="last-read-close" class="text-[var(--icon-fill)] hover:text-[var(--text-main)]">&times;</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const NOVEL_ID = document.body.dataset.novelId;
            const appContainer = document.getElementById('app-container');
            const contentContainer = document.getElementById('content-container');
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('menu');
            const overlay = document.getElementById('menu-overlay');
            const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
            const sidebarToggleIcon = document.getElementById('sidebar-toggle-icon');
            const scrollToTopBtn = document.getElementById('scroll-to-top');
            const scrollToBottomBtn = document.getElementById('scroll-to-bottom');
            const progressBar = document.getElementById('progress-bar');
            const progressPercent = document.getElementById('progress-percent');
            const settingToggleBtn = document.getElementById('setting-toggle-btn');
            const settingPanel = document.getElementById('setting-panel');
            const lastReadToast = document.getElementById('last-read-toast');
            const lastReadLink = document.getElementById('last-read-link');
            const lastReadClose = document.getElementById('last-read-close');
            const header = document.querySelector('header');
            const rememberPositionToggle = document.getElementById('remember-position-toggle');
            const desktopNav = document.getElementById('chapter-list');
            const mobileNavContainer = document.getElementById('mobile-chapter-list');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const fullscreenEnterIcon = document.getElementById('fullscreen-enter-icon');
            const fullscreenExitIcon = document.getElementById('fullscreen-exit-icon');
            const desktopChapterSearch = document.getElementById('desktop-chapter-search');
            const mobileChapterSearch = document.getElementById('mobile-chapter-search');

            const getSettings = () => JSON.parse(localStorage.getItem('readingSettings')) || { 
                size: 'md', family: 'serif', rememberPosition: false,
                lineHeight: 'normal', letterSpacing: 'normal', pageMargin: 'normal'
            };

            const saveReadingSetting = (key, value) => {
                const settings = getSettings();
                settings[key] = value;
                localStorage.setItem('readingSettings', JSON.stringify(settings));
                applyReadingSettings();
            };
            
            const applyReadingSettings = () => {
                const settings = getSettings();
                const classPrefixes = ['font-size-', 'font-family-', 'line-height-', 'letter-spacing-', 'page-margin-'];
                const newClasses = [
                    `font-size-${settings.size}`, `font-family-${settings.family}`,
                    `line-height-${settings.lineHeight}`, `letter-spacing-${settings.letterSpacing}`,
                    `page-margin-${settings.pageMargin}`
                ];
                const bodyClassList = document.body.classList;
                bodyClassList.forEach(cls => {
                    if (classPrefixes.some(prefix => cls.startsWith(prefix))) {
                        bodyClassList.remove(cls);
                    }
                });
                document.body.classList.add(...newClasses);

                document.querySelectorAll('.setting-option-btn[data-action]').forEach(btn => {
                    const action = btn.dataset.action;
                    const value = btn.dataset.value;
                    const settingMap = {
                        'set-font-size': 'size', 'set-font-family': 'family',
                        'set-line-height': 'lineHeight', 'set-letter-spacing': 'letterSpacing',
                        'set-page-margin': 'pageMargin'
                    };
                    if(settingMap[action] && settings[settingMap[action]] === value) {
                         btn.classList.add('active');
                    } else {
                         btn.classList.remove('active');
                    }
                });
                
                if (rememberPositionToggle) {
                    rememberPositionToggle.checked = !!settings.rememberPosition;
                }
            };

            const setTheme = (theme) => {
                document.body.className = document.body.className.replace(/theme-\w+/g, '');
                document.body.classList.add(`theme-${theme}`);
                localStorage.setItem('readingTheme', theme);
                document.querySelectorAll('.theme-switcher-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.theme === theme);
                });
            };
            
            const toggleMenu = (forceClose = false) => {
                const isOpen = !mobileMenu.classList.contains('-translate-x-full');
                if (forceClose || isOpen) {
                    mobileMenu.classList.add('-translate-x-full');
                    overlay.classList.add('opacity-0', 'pointer-events-none');
                    menuBtn.setAttribute('aria-expanded', 'false');
                } else {
                    mobileMenu.classList.remove('-translate-x-full');
                    overlay.classList.remove('opacity-0', 'pointer-events-none');
                    menuBtn.setAttribute('aria-expanded', 'true');
                }
            };
            
            const setupChapterToggles = (containerSelector) => {
                const container = document.querySelector(containerSelector);
                if (!container) return;
                container.addEventListener('click', (e) => {
                    const chevronBtn = e.target.closest('.chevron-btn');
                    if (chevronBtn) {
                        e.preventDefault();
                        const targetId = chevronBtn.dataset.toggleTarget;
                        const targetElement = document.getElementById(targetId);
                        const chevronIcon = chevronBtn.querySelector('.chevron-icon');
                        if (targetElement) {
                            const isHidden = targetElement.classList.toggle('hidden');
                            chevronIcon.classList.toggle('rotate-90');
                            chevronBtn.setAttribute('aria-expanded', String(!isHidden));
                        }
                    }
                });
            };

            const toggleFullScreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.error(`全螢幕模式錯誤: ${err.message} (${err.name})`);
                    });
                } else {
                    document.exitFullscreen();
                }
            };

            const updateFullscreenIcons = () => {
                if (fullscreenBtn) {
                    if (document.fullscreenElement) {
                        fullscreenEnterIcon.classList.add('hidden');
                        fullscreenExitIcon.classList.remove('hidden');
                    } else {
                        fullscreenEnterIcon.classList.remove('hidden');
                        fullscreenExitIcon.classList.add('hidden');
                    }
                }
            };

            const filterChapters = (query, navContainer) => {
                const lowerCaseQuery = query.toLowerCase().trim();
                const chapterItems = navContainer.querySelectorAll('.chapter-group, a.chapter-link:not(.chapter-group *)');
                chapterItems.forEach(item => {
                    const title = item.textContent.toLowerCase();
                    item.style.display = title.includes(lowerCaseQuery) ? '' : 'none';
                });
            };

            const currentTheme = localStorage.getItem('readingTheme') || 'paper';
            setTheme(currentTheme);
            applyReadingSettings();

            if (desktopNav && mobileNavContainer) {
                mobileNavContainer.innerHTML = desktopNav.innerHTML;
                mobileNavContainer.querySelectorAll('[id]').forEach(el => {
                    el.id = 'mobile-' + el.id;
                });
                mobileNavContainer.querySelectorAll('[data-toggle-target]').forEach(el => {
                    el.dataset.toggleTarget = 'mobile-' + el.dataset.toggleTarget;
                });
            }

            const updateSidebarIcon = (isCollapsed) => {
                sidebarToggleIcon.style.transform = isCollapsed ? 'rotate(180deg)' : 'rotate(0deg)';
            };
            const isSidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (isSidebarCollapsed) appContainer.classList.add('sidebar-collapsed');
            updateSidebarIcon(isSidebarCollapsed);
            sidebarToggleBtn.addEventListener('click', () => {
                const collapsed = appContainer.classList.toggle('sidebar-collapsed');
                localStorage.setItem('sidebarCollapsed', collapsed);
                updateSidebarIcon(collapsed);
            });

            menuBtn.addEventListener('click', () => toggleMenu());
            overlay.addEventListener('click', () => toggleMenu(true));
            mobileMenu.addEventListener('click', (e) => {
                if (e.target.closest('a')) {
                    toggleMenu(true);
                }
            });
            
            setupChapterToggles('#chapter-list');
            setupChapterToggles('#mobile-chapter-list');

            let scrollTimeout;
            const lastReadStorageKey = `lastRead_${NOVEL_ID}`;
            contentContainer.addEventListener('scroll', () => {
                const scrollableHeight = contentContainer.scrollHeight - contentContainer.clientHeight;
                const scrollTop = contentContainer.scrollTop;
                const percent = scrollableHeight > 0 ? (scrollTop / scrollableHeight) * 100 : 0;
                
                progressBar.style.width = `${percent}%`;
                progressPercent.textContent = `${Math.round(percent)}%`;
                scrollToTopBtn.classList.toggle('hidden', scrollTop <= 200);

                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    if (getSettings().rememberPosition) {
                        localStorage.setItem(lastReadStorageKey, JSON.stringify({
                            href: window.location.pathname,
                            scrollTop: scrollTop,
                        }));
                    }
                }, 500);
            });

            if (getSettings().rememberPosition) {
                const lastReadData = JSON.parse(localStorage.getItem(lastReadStorageKey));
                if (lastReadData && lastReadData.href) {
                    const currentPage = window.location.pathname.split('/').pop();
                    const lastReadPage = lastReadData.href.split('/').pop();
                    if (currentPage === lastReadPage) {
                        setTimeout(() => contentContainer.scrollTo({ top: lastReadData.scrollTop, behavior: 'auto' }), 100);
                    } else {
                        lastReadLink.href = lastReadData.href;
                        lastReadToast.classList.remove('hidden');
                    }
                }
            }
            lastReadClose.addEventListener('click', () => lastReadToast.classList.add('hidden'));

            scrollToTopBtn.addEventListener('click', () => contentContainer.scrollTo({ top: 0, behavior: 'smooth' }));
            scrollToBottomBtn.addEventListener('click', () => contentContainer.scrollTo({ top: contentContainer.scrollHeight, behavior: 'smooth' }));
            
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                const prevLink = document.querySelector('link[rel="prev"]');
                const nextLink = document.querySelector('link[rel="next"]');
                if (e.key === 'ArrowLeft' && prevLink?.href) window.location.href = prevLink.href;
                if (e.key === 'ArrowRight' && nextLink?.href) window.location.href = nextLink.href;
            });

            document.body.addEventListener('click', (e) => {
                const themeBtn = e.target.closest('.theme-switcher-btn[data-theme]');
                if (themeBtn) {
                    setTheme(themeBtn.dataset.theme);
                }
            });

            settingToggleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = settingPanel.classList.toggle('hidden');
                settingToggleBtn.setAttribute('aria-expanded', !isHidden);
            });
            document.addEventListener('click', (e) => {
                if (!settingPanel.contains(e.target) && !settingToggleBtn.contains(e.target)) {
                    settingPanel.classList.add('hidden');
                    settingToggleBtn.setAttribute('aria-expanded', 'false');
                }
            });
            settingPanel.addEventListener('click', (e) => {
                const btn = e.target.closest('[data-action]');
                if (btn) {
                    const { action, value } = btn.dataset;
                    if (action === 'fullscreen') {
                        toggleFullScreen();
                        return;
                    }
                    const settingMap = {
                        'set-font-size': 'size', 'set-font-family': 'family',
                        'set-line-height': 'lineHeight', 'set-letter-spacing': 'letterSpacing',
                        'set-page-margin': 'pageMargin'
                    };
                    if(settingMap[action]) {
                        saveReadingSetting(settingMap[action], value);
                    }
                }
            });
            rememberPositionToggle.addEventListener('change', (e) => {
                saveReadingSetting('rememberPosition', e.target.checked);
            });
            if(fullscreenBtn) {
                fullscreenBtn.addEventListener('click', toggleFullScreen);
                document.addEventListener('fullscreenchange', updateFullscreenIcons);
            }

            desktopChapterSearch.addEventListener('input', (e) => filterChapters(e.target.value, desktopNav));
            mobileChapterSearch.addEventListener('input', (e) => filterChapters(e.target.value, mobileNavContainer));

            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./service-worker.js')
                        .then(reg => console.log('ServiceWorker registration successful.', reg))
                        .catch(err => console.log('ServiceWorker registration failed: ', err));
                });
            }
        });
    </script>
</body>
</html>
