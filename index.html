<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾ç¾¤å¹³å°æ¦‚å¿µäº’å‹•å°è¦½ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- åŸºç¤æ¨£å¼ --- */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f5f5f4; /* æš–è‰²ä¸­æ€§: Stone 100 */
            color: #292524; /* Stone 800 */
        }
        .tab-active {
            background-color: #0c4a6e; /* å¼·èª¿è‰²: Sky 900 */
            color: #f0f9ff;
        }
        .tab-inactive {
            background-color: #e7e5e4; /* Stone 200 */
            color: #57534e; /* Stone 600 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 40vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 384px;
            }
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0c4a6e;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- æ•™å­¸å°è¦½æ¨£å¼ (æ•´åˆè‡ª index2.html) --- */
        .tutorial-backdrop {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.6);
            z-index: 100;
            display: none; /* é è¨­éš±è— */
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }
        .tutorial-container {
            width: 100%;
            max-width: 48rem; /* max-w-3xl */
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
        }
        .step-card {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
            display: none;
        }
        .step-card.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }
        .choice-card {
            border: 2px solid #e7e5e4;
            border-radius: 0.75rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .choice-card:hover {
            border-color: #0ea5e9;
            transform: translateY(-5px);
        }
        .choice-card.selected {
            border-color: #0ea5e9;
            background-color: #f0f9ff;
            box-shadow: 0 0 15px rgba(14, 165, 233, 0.3);
        }
        .long-press-indicator {
            position: absolute; top: 50%; left: 50%;
            width: 80px; height: 80px; margin-top: -40px; margin-left: -40px;
            border-radius: 50%; background-color: rgba(14, 165, 233, 0.2);
            transform: scale(0.5); opacity: 0;
            transition: all 0.2s ease-out; pointer-events: none; z-index: 10;
        }
        .long-press-indicator.pressing { opacity: 1; transform: scale(1); }
        .long-press-indicator::before {
            content: ''; position: absolute; inset: 0; border-radius: 50%;
            border: 4px solid #0ea5e9;
            clip-path: polygon(50% 50%, 50% 0, 0 0, 0 100%, 100% 100%, 100% 0, 50% 0);
            transform: rotate(var(--angle, -90deg)); transition: none;
        }
        .menu-template {
            position: fixed; background: white; border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 0.5rem;
            display: none; flex-direction: column; gap: 0.25rem;
            z-index: 150; /* æ¯”æ•™å­¸èƒŒæ™¯æ›´é«˜ */
            width: max-content; animation: scale-up 0.2s ease-out;
        }
        .menu-template.active { display: flex; }
        @keyframes scale-up {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .menu-btn {
            padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s;
            cursor: pointer; text-align: left; display: flex; align-items: center; gap: 0.5rem;
        }
        .menu-btn:hover { background-color: #f4f4f5; }
        .rating-btn.selected { background-color: #0ea5e9; color: white; }
        .tag-btn {
            padding: 0.25rem 0.75rem; border: 1px solid #d4d4d8; border-radius: 9999px;
            font-size: 0.875rem; transition: all 0.2s;
        }
        .tag-btn.selected { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        .info-modal-backdrop {
            position: fixed; inset: 0; background-color: rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
            z-index: 200; /* æœ€é«˜å±¤ç´š */
            opacity: 0; transition: opacity 0.2s ease-in-out; pointer-events: none;
        }
        .info-modal-backdrop.active { opacity: 1; pointer-events: auto; }
        .info-modal-content {
            background: white; padding: 2rem; border-radius: 1rem;
            max-width: 90%; width: 500px; text-align: center;
            transform: scale(0.95); transition: transform 0.2s ease-in-out;
            position: relative;
        }
        .info-modal-backdrop.active .info-modal-content { transform: scale(1); }
        .flooding-comment {
            position: absolute; background: #fecaca; border: 1px solid #ef4444;
            border-radius: 0.75rem; padding: 0.5rem 1rem; font-size: 0.875rem;
            opacity: 0; animation: simple-flood-and-fade 4s ease-out forwards;
        }
        @keyframes simple-flood-and-fade {
            0% { opacity: 0; transform: scale(0.8); }
            25% { opacity: 1; transform: scale(1); }
            75% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.8); }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-stone-800 text-white shadow-lg sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold">ç†æ€§ç¤¾ç¾¤å¹³å°ãƒ»æ¦‚å¿µå°è¦½</h1>
            <div class="hidden md:flex space-x-6">
                <a href="#concept" class="hover:text-sky-300 transition duration-300">æ ¸å¿ƒç†å¿µ</a>
                <a href="#metrics" class="hover:text-sky-300 transition duration-300">ä¸‰å¤§æŒ‡æ¨™</a>
                <a href="#preview" class="hover:text-sky-300 transition duration-300">ä»‹é¢é è¦½</a>
                <a href="#about" class="hover:text-sky-300 transition duration-300">é—œæ–¼æˆ‘å€‘</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden px-6 pt-2 pb-4">
            <a href="#concept" class="block py-2 hover:text-sky-300">æ ¸å¿ƒç†å¿µ</a>
            <a href="#metrics" class="block py-2 hover:text-sky-300">ä¸‰å¤§æŒ‡æ¨™</a>
            <a href="#preview" class="block py-2 hover:text-sky-300">ä»‹é¢é è¦½</a>
            <a href="#about" class="block py-2 hover:text-sky-300">é—œæ–¼æˆ‘å€‘</a>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <section id="concept" class="my-12 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center text-sky-900 mb-4">æ ¸å¿ƒç†å¿µï¼šæ‰“é€ é«˜åª’é«”è­˜è®€çš„ç¤¾ç¾¤</h2>
            <p class="max-w-3xl mx-auto text-center text-stone-600 mb-12">
                æœ¬å°ˆæ¡ˆæ—¨åœ¨æ‡‰å°ç•¶å‰ç¤¾æœƒçŒ–ç—çš„å‡æ–°èã€æƒ¡æ„æŠ¹é»‘èˆ‡æ–·ç« å–ç¾©ã€‚æˆ‘å€‘æå‡ºä¸€å€‹å‰µæ–°çš„ç¤¾ç¾¤å¹³å°ï¼Œé€éç¨ç‰¹çš„çå‹µæ©Ÿåˆ¶èˆ‡ä½¿ç”¨è€…æŒ‡æ¨™ï¼Œé¼“å‹µç†æ€§è¨è«–ã€åŒ…å®¹å¤šå…ƒè²éŸ³ï¼Œæœ€çµ‚å»ºç«‹ä¸€å€‹é«˜ä¿¡ä»»åº¦çš„è³‡è¨Šäº¤æµç©ºé–“ã€‚
            </p>
            <div class="grid md:grid-cols-2 gap-8 items-start">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-2xl font-bold mb-3 text-red-700">ç•¶å‰å›°å¢ƒ</h3>
                    <ul class="space-y-3 text-stone-700">
                        <li class="flex items-start"><span class="text-red-500 mr-3 text-2xl">âš ï¸</span><span>è³‡è¨Šå¯ä¿¡åº¦ä½ï¼Œå‡æ–°èèˆ‡è¬ è¨€æ°¾æ¿«ã€‚</span></li>
                        <li class="flex items-start"><span class="text-red-500 mr-3 text-2xl">ğŸ—£ï¸</span><span>åŒæº«å±¤æ•ˆæ‡‰é¡¯è‘—ï¼Œç¼ºä¹è·¨ç«‹å ´çš„ç†æ€§å°è©±ã€‚</span></li>
                        <li class="flex items-start"><span class="text-red-500 mr-3 text-2xl">âš”ï¸</span><span>è¨è«–å®¹æ˜“æµæ–¼æƒ…ç·’åŒ–ç™¼è¨€èˆ‡äººèº«æ”»æ“Šã€‚</span></li>
                    </ul>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-2xl font-bold mb-3 text-green-700">æˆ‘å€‘çš„è§£æ–¹</h3>
                    <ul class="space-y-3 text-stone-700">
                        <li class="flex items-start"><span class="text-green-500 mr-3 text-2xl">ğŸ›¡ï¸</span><span>å»ºç«‹ä»¥ã€Œä¿¡ä»»å€¼ã€ç‚ºæ ¸å¿ƒçš„å…§å®¹å“è³ªéæ¿¾æ©Ÿåˆ¶ã€‚</span></li>
                        <li class="flex items-start"><span class="text-green-500 mr-3 text-2xl">ğŸŒ</span><span>é€éã€Œæ·±åº¦å€¼ã€é¼“å‹µç”¨æˆ¶æ¥è§¸å¤šå…ƒè§€é»ï¼Œæ‰“ç ´åŒæº«å±¤ã€‚</span></li>
                        <li class="flex items-start"><span class="text-green-500 mr-3 text-2xl">ğŸ“ˆ</span><span>ä»¥ã€Œè²¢ç»å€¼ã€é‡åŒ–ç”¨æˆ¶åƒèˆ‡åº¦ï¼Œå€åˆ†çœŸå¯¦ç”¨æˆ¶èˆ‡æ©Ÿå™¨äººã€‚</span></li>
                        <li class="flex items-start"><span class="text-green-500 mr-3 text-2xl">âœ¨</span><span class="font-bold">æ•´åˆ Gemini AI</span><span>ï¼Œæä¾›ä¸­ç«‹æ‘˜è¦èˆ‡è«–é»åˆ†æï¼Œè¼”åŠ©æ·±åº¦æ€è€ƒã€‚</span></li>
                    </ul>
                </div>
            </div>
            <div class="mt-12 text-center">
                <button id="start-tutorial-btn" class="bg-sky-700 text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-sky-800 transition-transform transform hover:scale-105 shadow-lg">
                    <span class="text-2xl mr-2">ğŸš€</span> å•Ÿå‹•äº’å‹•æ•™å­¸
                </button>
                <p class="text-stone-500 mt-3 text-sm">è¦ªèº«é«”é©—å¹³å°çš„æ ¸å¿ƒäº’å‹•ï¼Œå­¸ç¿’å¦‚ä½•æˆç‚ºé«˜åª’é«”è­˜è®€å…¬æ°‘ã€‚</p>
            </div>
        </section>

        <section id="metrics" class="my-24 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center text-sky-900 mb-12">ä¸‰å¤§æ ¸å¿ƒæŒ‡æ¨™äº’å‹•è§£æ</h2>
            
            <div class="flex justify-center mb-8 border-b-2 border-stone-300">
                <button data-tab="contribution" class="metric-tab tab-active text-lg font-semibold py-3 px-6 rounded-t-lg transition-colors duration-300">è²¢ç»å€¼</button>
                <button data-tab="trust" class="metric-tab tab-inactive text-lg font-semibold py-3 px-6 rounded-t-lg transition-colors duration-300">ä¿¡ä»»å€¼</button>
                <button data-tab="depth" class="metric-tab tab-inactive text-lg font-semibold py-3 px-6 rounded-t-lg transition-colors duration-300">æ·±åº¦å€¼</button>
            </div>

            <div id="contribution" class="metric-content">
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="text-2xl font-bold mb-2">è²¢ç»å€¼ (Contribution Value)</h3>
                        <p class="text-stone-600 mb-4">è¡¡é‡ç”¨æˆ¶çš„<strong>åƒèˆ‡åº¦</strong>èˆ‡<strong>æ´»èºåº¦</strong>ï¼Œä½œç‚ºä¸€å€‹å‹•æ…‹çš„åƒèˆ‡è­‰æ˜ï¼Œæœ‰æ•ˆå€åˆ†é•·æœŸç”¨æˆ¶èˆ‡æ½›åœ¨çš„æ©Ÿå™¨äººå¸³è™Ÿã€‚</p>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h4 class="font-bold text-lg mb-2">è¨ˆç®—æ–¹å¼ï¼šæ™‚é–“è¡°æ¸›æ¨¡å‹</h4>
                            <p class="mb-4 text-sm text-stone-500">è²¢ç»å€¼çµåˆã€Œæ¯æ—¥æ´»èºã€èˆ‡ã€Œæ­·å²è²¢ç»ã€ã€‚æ­·å²è²¢ç»æœƒéš¨æ™‚é–“æ¯æ—¥å¾®å¹…è¡°æ¸›ï¼Œé¼“å‹µç”¨æˆ¶ä¿æŒæŒçºŒæ´»èºã€‚</p>
                            <p class="font-mono bg-stone-100 p-2 rounded">æ¯æ—¥è²¢ç» = (æ¯æ—¥æ´»èºåˆ†æ•¸) + (æ˜¨æ—¥è²¢ç» * 0.99)</p>
                            <button id="simulate-contribution" class="mt-4 w-full bg-sky-700 text-white py-2 px-4 rounded-lg hover:bg-sky-800 transition">æ¨¡æ“¬30å¤©æ´»èº/ä¸æ´»èºè®ŠåŒ–</button>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-lg">
                        <div class="chart-container">
                            <canvas id="contributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="trust" class="metric-content hidden">
                 <div class="grid md:grid-cols-2 gap-8 items-start">
                    <div>
                        <h3 class="text-2xl font-bold mb-2">ä¿¡ä»»å€¼ (Trust Value)</h3>
                        <p class="text-stone-600 mb-4">å¹³å°å…¬ä¿¡åŠ›çš„åŸºçŸ³ã€‚è¡¡é‡ç”¨æˆ¶ç™¼è¨€èˆ‡å…§å®¹çš„<strong>å¯ä¿¡åº¦</strong>ï¼Œé«˜ä¿¡ä»»å€¼ç”¨æˆ¶çš„è©•åƒ¹å…·æœ‰æ›´é«˜æ¬Šé‡ã€‚</p>
                        
                        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                            <h4 class="font-bold text-lg mb-2">äº’å‹•æ¨¡æ“¬ï¼šæ¬Šé‡è©•åƒ¹çš„é‚Šéš›æ•ˆæ‡‰</h4>
                            <p class="mb-4 text-sm text-stone-500">ç”¨æˆ¶çš„ä¿¡ä»»å€¼è¶Šé«˜ï¼Œå…¶è©•åƒ¹æ¬Šé‡ä¹Ÿè¶Šé«˜ï¼Œä½†å¢é•·å¹…åº¦æœƒéæ¸›ï¼Œä»¥é˜²æ¬ŠåŠ›éåº¦é›†ä¸­ã€‚æ‹–å‹•ä¸‹æ–¹æ»‘æ¡¿ï¼Œè§€å¯Ÿæ¬Šé‡è®ŠåŒ–ã€‚</p>
                            <input id="trust-slider" type="range" min="1" max="1000" value="100" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer">
                             <div class="text-center mt-2">ç•¶å‰æ¨¡æ“¬ä¿¡ä»»å€¼: <span id="trust-value-display" class="font-bold">100</span></div>
                        </div>

                         <div class="bg-white p-6 rounded-lg shadow-md">
                            <h4 class="font-bold text-lg mb-2">æ©Ÿåˆ¶ï¼šå¤šå±¤æ¬¡äº‹å¯¦æŸ¥æ ¸æµç¨‹</h4>
                            <ol class="relative border-l border-stone-300 space-y-6 mt-4 ml-2">
                                <li class="ml-6">
                                    <span class="absolute flex items-center justify-center w-6 h-6 bg-sky-200 rounded-full -left-3 ring-4 ring-white">1</span>
                                    <h5 class="font-semibold">ç”¨æˆ¶èˆ‰å ±</h5>
                                    <p class="text-sm text-stone-500">ä»»ä½•ç”¨æˆ¶çš†å¯æ¨™è¨˜ã€Œç–‘ä¼¼è™›å‡ã€å…§å®¹ã€‚</p>
                                </li>
                                <li class="ml-6">
                                    <span class="absolute flex items-center justify-center w-6 h-6 bg-sky-200 rounded-full -left-3 ring-4 ring-white">2</span>
                                    <h5 class="font-semibold">ç¤¾ç¾¤å¯©è­°</h5>
                                    <p class="text-sm text-stone-500">é”åˆ°èˆ‰å ±é–€æª»å¾Œï¼Œç”±é«˜æ¨™æº–ç”¨æˆ¶äº¤å‰å¯©è­°ã€‚</p>
                                </li>
                                <li class="ml-6">
                                    <span class="absolute flex items-center justify-center w-6 h-6 bg-sky-200 rounded-full -left-3 ring-4 ring-white">3</span>
                                    <h5 class="font-semibold">å°ˆå®¶ä»²è£</h5>
                                    <p class="text-sm text-stone-500">é‡å¤§çˆ­è­°å¼•å…¥é ˜åŸŸå°ˆå®¶åšæœ€çµ‚åˆ¤å®šã€‚</p>
                                </li>
                            </ol>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-lg">
                        <div class="chart-container">
                            <canvas id="trustChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="depth" class="metric-content hidden">
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="text-2xl font-bold mb-2">æ·±åº¦å€¼ (Depth Value)</h3>
                        <p class="text-stone-600 mb-4">æ‰“ç ´åŒæº«å±¤çš„åˆ©å™¨ã€‚è¡¡é‡ç”¨æˆ¶çš„<strong>æ€ç¶­å»£åº¦</strong>ï¼Œåˆ¤æ–·å…¶æ˜¯å¦é¡˜æ„æ¥è§¸ä¸¦ç†è§£ä¸åŒè§€é»ã€‚</p>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h4 class="font-bold text-lg mb-2">è¦–è¦ºåŒ–å‘ˆç¾</h4>
                            <p class="mb-4 text-sm text-stone-500">é€éã€Œä¸»é¡Œæ¶‰çµå»£åº¦ã€èˆ‡ã€Œè§€é»æ¥è§¸æ¯”ä¾‹ã€ä¾†å‘ˆç¾ç”¨æˆ¶çš„æ€ç¶­æ¨£è²Œã€‚é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œåˆ‡æ›ä¸åŒé¡å‹çš„ç”¨æˆ¶æª”æ¡ˆã€‚</p>
                            <div class="flex flex-wrap gap-2">
                                <button data-profile="balanced" class="depth-profile-btn flex-1 bg-sky-700 text-white py-2 px-4 rounded-lg hover:bg-sky-800 transition">å‡è¡¡å‹ç”¨æˆ¶</button>
                                <button data-profile="specialist" class="depth-profile-btn flex-1 bg-stone-500 text-white py-2 px-4 rounded-lg hover:bg-stone-600 transition">å°ˆæ¥­å‹ç”¨æˆ¶</button>
                                <button data-profile="echo-chamber" class="depth-profile-btn flex-1 bg-red-700 text-white py-2 px-4 rounded-lg hover:bg-red-800 transition">åŒæº«å±¤ç”¨æˆ¶</button>
                            </div>
                        </div>
                         <div class="bg-white p-4 rounded-lg shadow-lg mt-6">
                            <h4 class="text-center font-bold mb-2">è§€é»æ¥è§¸æ¯”ä¾‹</h4>
                            <div class="chart-container !h-48">
                                <canvas id="depthBarChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-lg">
                        <h4 class="text-center font-bold mb-2">ä¸»é¡Œæ¶‰çµå»£åº¦</h4>
                        <div class="chart-container">
                            <canvas id="depthRadarChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="preview" class="my-24 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center text-sky-900 mb-12">ä»‹é¢é è¦½ï¼šAI è³¦èƒ½çš„äº’å‹•é«”é©—</h2>
            <p class="max-w-3xl mx-auto text-center text-stone-600 mb-12">
                å¥½çš„ç†å¿µéœ€è¦å¥½çš„ä»‹é¢ä¾†æ‰¿è¼‰ã€‚ä»¥ä¸‹æ¨¡æ“¬æ•´åˆäº† Gemini AI åŠŸèƒ½çš„ App ä»‹é¢ï¼Œå±•ç¤ºç”¨æˆ¶å°‡å¦‚ä½•èˆ‡å¹³å°äº’å‹•ã€‚
            </p>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-stone-200 p-4 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-center">ä¸»ç•«é¢ï¼šäº‹ä»¶æ˜Ÿçƒç‰†</h3>
                    <div class="space-y-4">
                        <div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                            <div class="text-4xl">ğŸª</div>
                            <div>
                                <h4 class="font-bold">æŸå…¬å¸ç™¼å¸ƒæ–°ç”¢å“</h4>
                                <div class="flex items-center text-sm text-stone-500 mt-1">
                                    <span class="bg-sky-100 text-sky-800 px-2 py-0.5 rounded-full">ç§‘æŠ€</span>
                                    <span class="ml-4">ğŸ”¥ ç†±åº¦: 85</span>
                                </div>
                            </div>
                        </div>
                         <div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                            <div class="text-4xl">ğŸŒ</div>
                            <div>
                                <h4 class="font-bold">æŸæ”¿æ²»äººç‰©è¨ªå•æŸåœ‹</h4>
                                <div class="flex items-center text-sm text-stone-500 mt-1">
                                    <span class="bg-red-100 text-red-800 px-2 py-0.5 rounded-full">æ”¿æ²»</span>
                                    <span class="ml-4">ğŸ”¥ ç†±åº¦: 98 (é«˜çˆ­è­°)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-stone-200 p-4 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-center">æ˜Ÿçƒå…§éƒ¨ï¼šå¤šå…ƒè§€é»è«–å£‡</h3>
                     <div class="bg-white rounded-lg shadow p-4">
                        <div class="border-b pb-3 mb-3">
                            <h4 class="font-bold text-lg">ä¸­ç«‹äº‹ä»¶æè¿°</h4>
                            <button id="generate-summary-btn" class="w-full text-left bg-sky-100 text-sky-800 p-2 rounded-lg hover:bg-sky-200 transition flex items-center justify-center mt-2">
                                <span class="mr-2">âœ¨</span>
                                <span>AI ç”Ÿæˆä¸­ç«‹æ‘˜è¦</span>
                            </button>
                            <div id="summary-container" class="mt-2 text-sm text-stone-600 bg-stone-50 p-3 rounded-lg hidden"></div>
                        </div>
                        <div class="border-b pb-3 mb-3">
                            <h4 class="font-bold text-lg">æ­£æ–¹è«–è¿°</h4>
                            <p class="mt-1" id="argument-1">æ­¤ç”¢å“çš„å‰µæ–°æŠ€è¡“å°‡å¼•é ˜å¸‚å ´æ½®æµï¼Œå…¶è™•ç†é€Ÿåº¦æ¯”ä¸Šä¸€ä»£æå‡50%ï¼Œä¸¦æ¡ç”¨ç’°ä¿ææ–™è£½æˆã€‚</p>
                            <div class="text-xs mt-2 flex justify-between items-center">
                                <span>ç™¼æ–‡è€…ï¼šUser_A (ä¿¡850)</span>
                                <button class="analyze-btn bg-transparent text-sky-700 text-xs hover:underline" data-target="argument-1">âœ¨ AI åˆ†æè«–é»</button>
                            </div>
                        </div>
                         <div class="border-b pb-3 mb-3">
                            <h4 class="font-bold text-lg">åæ–¹è«–è¿°</h4>
                            <p class="mt-1" id="argument-2">å…¶éš±ç§æ”¿ç­–å­˜åœ¨å·¨å¤§é¢¨éšªï¼Œç”¨æˆ¶æ•¸æ“šå¯èƒ½è¢«ç”¨æ–¼ç¬¬ä¸‰æ–¹å»£å‘Šã€‚é›–ç„¶é€Ÿåº¦å¿«ï¼Œä½†èƒ½è€—å•é¡Œä¸¦æœªè§£æ±ºã€‚</p>
                            <div class="text-xs mt-2 flex justify-between items-center">
                                <span>ç™¼æ–‡è€…ï¼šUser_B (ä¿¡720)</span>
                                <button class="analyze-btn bg-transparent text-sky-700 text-xs hover:underline" data-target="argument-2">âœ¨ AI åˆ†æè«–é»</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- AI åˆ†æç”¨å½ˆå‡ºè¦–çª— -->
    <div id="analysis-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 relative">
            <button id="close-modal-btn" class="absolute top-3 right-3 text-stone-500 hover:text-stone-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-xl font-bold text-sky-900 mb-4">âœ¨ AI è«–é»åˆ†æ</h3>
            <div id="modal-content" class="space-y-4 text-stone-700 max-h-[60vh] overflow-y-auto">
            </div>
        </div>
    </div>

    <!-- æ•™å­¸å°è¦½ç”¨å½ˆå‡ºè¦–çª— -->
    <div id="tutorial-backdrop" class="tutorial-backdrop">
        <div class="tutorial-container">
            <div id="onboarding-flow">
                 <!-- æ•™å­¸æµç¨‹çš„ HTML å°‡ç”± JS å‹•æ…‹æ³¨å…¥æ­¤è™• -->
            </div>
        </div>
         <button id="close-tutorial-btn" class="absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
    </div>

    <!-- æ•™å­¸å°è¦½ç”¨çš„å¯è¤‡ç”¨é¸å–® -->
    <div id="context-menu" class="menu-template">
        <button class="menu-btn" data-action="rate">âœï¸ è©•åƒ¹è§€é»</button>
        <button class="menu-btn" data-action="report">ğŸš© èˆ‰å ±å…§å®¹</button>
        <button class="menu-btn" data-action="remove">ğŸ—‘ï¸ ç§»é™¤æˆ‘çš„è©•åƒ¹</button>
    </div>
    <div id="rating-menu" class="menu-template"></div>

    <!-- æ•™å­¸å°è¦½ç”¨çš„è³‡è¨Šå½ˆå‡ºè¦–çª— -->
    <div id="info-modal" class="info-modal-backdrop">
        <div class="info-modal-content">
            <h3 id="info-modal-title" class="text-2xl font-bold text-sky-900 mb-4"></h3>
            <div id="info-modal-body" class="text-stone-600 space-y-3 relative"></div>
            <div id="info-modal-footer" class="mt-6"></div>
        </div>
    </div>

    <footer id="about" class="bg-stone-800 text-white mt-16 pt-12 pb-8 scroll-mt-20">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-2xl font-bold mb-4">é—œæ–¼æˆ‘å€‘</h2>
            <p class="max-w-3xl mx-auto text-stone-300 mb-6">
                æˆ‘å€‘æ˜¯ä¸€ç¾¤ç†±è¡·æ–¼æ”¹å–„ç¶²è·¯è¨è«–é¢¨æ°£çš„é–‹ç™¼è€…èˆ‡è¨­è¨ˆå¸«ã€‚é€™å€‹å°ˆæ¡ˆçš„åˆè¡·ï¼Œæ˜¯æƒ³æ¢ç´¢ä¸€ç¨®å¯èƒ½æ€§ï¼šèƒ½å¦è¨­è¨ˆä¸€å€‹æ©Ÿåˆ¶ï¼Œåœ¨ä¸çŠ§ç‰²è¨€è«–è‡ªç”±çš„å‰æä¸‹ï¼Œå¼•å°ä½¿ç”¨è€…é€²è¡Œæ›´ç†æ€§ã€æ›´æœ‰å»ºè¨­æ€§çš„æºé€šï¼Ÿæˆ‘å€‘ç›¸ä¿¡ï¼Œé€éå¥½çš„è¨­è¨ˆèˆ‡æŠ€è¡“ï¼Œå¯ä»¥è³¦äºˆä½¿ç”¨è€…åŠ›é‡ï¼Œå…±åŒå¡‘é€ ä¸€å€‹æ›´é«˜å“è³ªçš„è³‡è¨Šç”Ÿæ…‹ç³»ã€‚
            </p>
            <p class="text-stone-400 mb-2">
                é€™å€‹äº’å‹•å°è¦½æ˜¯æˆ‘å€‘ç†å¿µçš„å…·é«”å‘ˆç¾ï¼Œç”¨æ–¼å±•ç¤ºæ ¸å¿ƒåŠŸèƒ½èˆ‡è¨­è¨ˆå“²å­¸ã€‚æˆ‘å€‘æœŸå¾…å®ƒèƒ½æ¿€ç™¼æ›´å¤šé—œæ–¼å¦‚ä½•å»ºç«‹å¥åº·ç¶²è·¯ç¤¾ç¾¤çš„è¨è«–ã€‚
            </p>
            <p class="text-stone-400">
                æœ‰ä»»ä½•æƒ³æ³•æˆ–å»ºè­°ï¼Ÿæ­¡è¿èˆ‡æˆ‘å€‘è¯çµ¡ï¼š<a href="mailto:yor31117@gmail.com" class="text-sky-400 hover:text-sky-300 underline">yor31117@gmail.com</a>
            </p>
            <p class="mt-8 text-sm text-stone-500">&copy; 2025 æ¦‚å¿µå°è¦½å°ˆæ¡ˆã€‚æ­¤ç‚ºæ¦‚å¿µå±•ç¤ºç¶²é ã€‚</p>
        </div>
    </footer>

<script>
// ä¸»é é¢é‚è¼¯
document.addEventListener('DOMContentLoaded', () => {
    // è¡Œå‹•ç‰ˆé¸å–®
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

    // å°è¦½åˆ—é»æ“Šå¾Œè‡ªå‹•æ”¶åˆè¡Œå‹•ç‰ˆé¸å–®
    document.querySelectorAll('#mobile-menu a, nav a').forEach(link => {
        link.addEventListener('click', () => {
            if (!link.href.includes('#')) return; // åªè™•ç†éŒ¨é»é€£çµ
            setTimeout(() => { // å»¶é²ä»¥ç¢ºä¿æ»¾å‹•å®Œæˆ
                 if (!mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('hidden');
                 }
            }, 100);
        });
    });

    // é ç±¤åˆ‡æ›
    const tabs = document.querySelectorAll('.metric-tab');
    const contents = document.querySelectorAll('.metric-content');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(item => item.classList.replace('tab-active', 'tab-inactive'));
            tab.classList.replace('tab-inactive', 'tab-active');
            contents.forEach(content => content.classList.add('hidden'));
            document.getElementById(tab.dataset.tab).classList.remove('hidden');
        });
    });

    // Chart.js åœ–è¡¨å¯¦ä¾‹
    let contributionChart, trustChart, depthRadarChart, depthBarChart;

    function createContributionChart() {
        const ctx = document.getElementById('contributionChart').getContext('2d');
        contributionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({ length: 30 }, (_, i) => `Day ${i + 1}`),
                datasets: [{
                    label: 'æ´»èºç”¨æˆ¶è²¢ç»å€¼', data: [], borderColor: '#0ea5e9',
                    backgroundColor: 'rgba(14, 165, 233, 0.1)', fill: true, tension: 0.4,
                }, {
                    label: 'ä¸æ´»èºç”¨æˆ¶è²¢ç»å€¼', data: [], borderColor: '#78716c',
                    backgroundColor: 'rgba(120, 113, 108, 0.1)', fill: true, tension: 0.4,
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: 'è²¢ç»å€¼éš¨æ™‚é–“è®ŠåŒ–æ¨¡æ“¬' } } }
        });
        simulateContribution();
    }
    
    function simulateContribution() {
        let activeValue = 100, inactiveValue = 100;
        const activeData = [], inactiveData = [];
        for (let i = 0; i < 30; i++) {
            activeValue = 10 + (activeValue * 0.99);
            inactiveValue = 0 + (inactiveValue * 0.99);
            activeData.push(activeValue);
            inactiveData.push(inactiveValue);
        }
        contributionChart.data.datasets[0].data = activeData;
        contributionChart.data.datasets[1].data = inactiveData;
        contributionChart.update();
    }
    document.getElementById('simulate-contribution').addEventListener('click', simulateContribution);

    function createTrustChart() {
        const ctx = document.getElementById('trustChart').getContext('2d');
        trustChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['è©•åƒ¹æ¬Šé‡'],
                datasets: [{ data: [calculateTrustWeight(100)], backgroundColor: ['#0c4a6e'] }]
            },
            options: {
                responsive: true, maintainAspectRatio: false, indexAxis: 'y',
                scales: { x: { beginAtZero: true, max: 100, title: { display: true, text: 'æ¬Šé‡ (Max 100)' } } },
                plugins: { title: { display: true, text: 'ä¿¡ä»»å€¼èˆ‡è©•åƒ¹æ¬Šé‡é—œä¿‚' }, legend: { display: false } }
            }
        });
    }
    function calculateTrustWeight(value) { return Math.log10(value) * 33.3; }
    document.getElementById('trust-slider').addEventListener('input', (e) => {
        document.getElementById('trust-value-display').textContent = e.target.value;
        trustChart.data.datasets[0].data[0] = calculateTrustWeight(e.target.value);
        trustChart.update();
    });

    function createDepthCharts() {
        const radarCtx = document.getElementById('depthRadarChart').getContext('2d');
        depthRadarChart = new Chart(radarCtx, {
            type: 'radar',
            data: {
                labels: ['ç§‘æŠ€', 'æ”¿æ²»', 'å¨›æ¨‚', 'è²¡ç¶“', 'ç”Ÿæ´»', 'å­¸è¡“'],
                datasets: [{ data: [], fill: true, backgroundColor: 'rgba(14, 165, 233, 0.2)', borderColor: 'rgb(14, 165, 233)' }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { r: { suggestedMin: 0, suggestedMax: 100 } } }
        });
        const barCtx = document.getElementById('depthBarChart').getContext('2d');
        depthBarChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: ['è§€é»æ¥è§¸'],
                datasets: [
                    { label: 'æ­£æ–¹è§€é»', data: [], backgroundColor: '#3b82f6' },
                    { label: 'åæ–¹è§€é»', data: [], backgroundColor: '#ef4444' }
                ]
            },
            options: {
                indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                scales: { x: { stacked: true, display: false }, y: { stacked: true, display: false } },
                plugins: { legend: { position: 'bottom' } }
            }
        });
        updateDepthCharts('balanced');
    }
    const depthProfiles = {
        balanced: { radar: [80, 70, 60, 75, 85, 50], bar: [55, 45] },
        specialist: { radar: [95, 20, 10, 80, 30, 90], bar: [60, 40] },
        'echo-chamber': { radar: [10, 95, 80, 5, 20, 5], bar: [95, 5] }
    };
    function updateDepthCharts(profileName) {
        const profile = depthProfiles[profileName];
        depthRadarChart.data.datasets[0].data = profile.radar;
        depthRadarChart.update();
        depthBarChart.data.datasets[0].data = [profile.bar[0]];
        depthBarChart.data.datasets[1].data = [profile.bar[1]];
        depthBarChart.update();
    }
    document.querySelectorAll('.depth-profile-btn').forEach(btn => btn.addEventListener('click', () => updateDepthCharts(btn.dataset.profile)));

    createContributionChart();
    createTrustChart();
    createDepthCharts();

    // Gemini AI æ¨¡æ“¬å‘¼å«é‚è¼¯
    async function callGeminiAPI(prompt) {
        // é€™æ˜¯ä¸€å€‹æ¨¡æ“¬å‡½å¼ã€‚åœ¨çœŸå¯¦æƒ…å¢ƒä¸­ï¼Œé€™è£¡æœƒå‘¼å«å¾Œç«¯ APIã€‚
        const modalContent = document.getElementById('modal-content');
        const summaryContainer = document.getElementById('summary-container');
        
        let responseText = "AI æ€è€ƒä¸­...";
        if (prompt.includes("æ‘˜è¦")) {
            responseText = "æ ¹æ“šå…¬é–‹è³‡è¨Šï¼Œè©²æ”¿æ²»äººç‰©æ–¼æœ¬é€±å±•é–‹ç‚ºæœŸä¸‰å¤©çš„åœ‹æ˜¯è¨ªå•ï¼Œé è¨ˆå°‡èˆ‡å°æ–¹å…ƒé¦–å°±ç¶“è²¿åˆä½œåŠå€åŸŸå®‰å…¨è­°é¡Œäº¤æ›æ„è¦‹ã€‚æ­¤è¡Œç¨‹å—åˆ°åœ‹éš›ç¤¾æœƒé«˜åº¦é—œæ³¨ã€‚";
        } else {
            responseText = `**æ ¸å¿ƒè«–é»ç¸½çµ**ï¼šç™¼è¨€è€…èªç‚ºæ­¤ç”¢å“çš„æŠ€è¡“å„ªå‹¢ï¼ˆé€Ÿåº¦ã€ç’°ä¿ï¼‰æ˜¯å…¶ä¸»è¦è³£é»ã€‚\n\n**å¯æ¢ç´¢çš„å•é¡Œ**ï¼š\n1. é€™äº›æŠ€è¡“å„ªå‹¢æ˜¯å¦å·²é€šéç¬¬ä¸‰æ–¹ç¨ç«‹é©—è­‰ï¼Ÿ\n2. èˆ‡å¸‚å ´ä¸ŠåŒé¡ç”¢å“ç›¸æ¯”ï¼Œå…¶ã€Œç’°ä¿ææ–™ã€çš„å…·é«”å®šç¾©å’Œæ¨™æº–æ˜¯ä»€éº¼ï¼Ÿ\n3. æå‡50%é€Ÿåº¦çš„åŒæ™‚ï¼Œæ˜¯å¦çŠ§ç‰²äº†å…¶ä»–æ€§èƒ½ï¼Œå¦‚ç©©å®šæ€§æˆ–é›»æ± çºŒèˆªï¼Ÿ`;
        }

        return new Promise(resolve => {
            setTimeout(() => {
                resolve(responseText);
            }, 1500);
        });
    }

    const generateSummaryBtn = document.getElementById('generate-summary-btn');
    const summaryContainer = document.getElementById('summary-container');
    generateSummaryBtn.addEventListener('click', async () => {
        summaryContainer.classList.remove('hidden');
        summaryContainer.innerHTML = '<div class="flex items-center justify-center"><div class="loader"></div><span class="ml-3">AI æ‘˜è¦ç”Ÿæˆä¸­...</span></div>';
        const prompt = `è«‹é‡å°ä»¥ä¸‹äº‹ä»¶æ¨™é¡Œï¼Œç”Ÿæˆä¸€æ®µç´„100å­—çš„å®¢è§€ã€ä¸­ç«‹ã€ä¸å¸¶åè¦‹çš„äº‹ä»¶æ‘˜è¦...`;
        const summary = await callGeminiAPI(prompt);
        summaryContainer.innerHTML = summary.replace(/\n/g, '<br>');
    });

    const analysisModal = document.getElementById('analysis-modal');
    const modalContent = document.getElementById('modal-content');
    document.querySelectorAll('.analyze-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
            const argumentText = document.getElementById(btn.dataset.target).textContent;
            analysisModal.classList.add('flex');
            analysisModal.classList.remove('hidden');
            modalContent.innerHTML = '<div class="flex items-center justify-center"><div class="loader"></div><span class="ml-3">AI åˆ†æä¸­...</span></div>';
            const prompt = `è«‹é‡å°ä»¥ä¸‹è«–è¿°é€²è¡Œåˆ†æ...`;
            const analysis = await callGeminiAPI(prompt);
            modalContent.innerHTML = analysis.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/gs, '<strong class="font-bold text-sky-800">$1</strong>');
        });
    });
    document.getElementById('close-modal-btn').addEventListener('click', () => analysisModal.classList.add('hidden'));
    analysisModal.addEventListener('click', (e) => { if (e.target === analysisModal) analysisModal.classList.add('hidden'); });

    // --- äº’å‹•æ•™å­¸æ•´åˆé‚è¼¯ (å¾ index2.html å®Œæ•´é‚„åŸ) ---
    const startTutorialBtn = document.getElementById('start-tutorial-btn');
    const tutorialBackdrop = document.getElementById('tutorial-backdrop');
    const closeTutorialBtn = document.getElementById('close-tutorial-btn');
    const onboardingFlowContainer = document.getElementById('onboarding-flow');

    function startTutorial() {
        // å°‡ index2.html çš„æ•™å­¸å…§å®¹å®Œæ•´æ³¨å…¥åˆ°å½ˆå‡ºè¦–çª—ä¸­
        onboardingFlowContainer.innerHTML = `
            <div id="step-1" class="step-card active text-center">
                <h1 class="text-3xl md:text-4xl font-bold text-sky-900 mb-4">æ­¡è¿ä¾†åˆ°ä¸€å€‹éœ€è¦æ€è€ƒçš„ç¤¾ç¾¤</h1>
                <p class="text-stone-600 mb-8">åœ¨é€™è£¡ï¼Œæ‚¨çš„åˆ¤æ–·åŠ›æ¯”è²é‡æ›´é‡è¦ã€‚</p>
                <button data-next="step-2" class="next-btn bg-sky-700 text-white font-bold py-3 px-8 rounded-full hover:bg-sky-800 transition-transform transform hover:scale-105">é–‹å§‹æˆ‘çš„æŒ‘æˆ°</button>
            </div>
            <div id="step-2" class="step-card">
                <h2 class="text-2xl font-bold text-center mb-2">æ‚¨çš„ç¬¬ä¸€å€‹æŒ‘æˆ°</h2>
                <p class="text-center text-stone-500 mb-8">è¿‘æœŸæœ‰ä¸€å€‹é—œæ–¼ã€ŒAI æ˜¯å¦æœƒå–ä»£äººé¡å·¥ä½œã€çš„ç†±é–€è¨è«–ï¼Œä»¥ä¸‹æœ‰å…©å‰‡è©•è«–ï¼Œè«‹æ‚¨åˆ¤æ–·å“ªä¸€å‰‡æ›´æœ‰åƒè€ƒåƒ¹å€¼ï¼Ÿ</p>
                <div id="challenge-container" class="space-y-4 relative overflow-hidden rounded-lg p-2 -m-2">
                    <div id="choice-a" class="choice-card"><p class="font-bold">è©•è«– A</p><p class="text-stone-700 mt-2">ã€ŒAI å°±æ˜¯å€‹åƒåœ¾ï¼åªæœƒæ¶èµ°æˆ‘å€‘çš„å·¥ä½œï¼Œæ”¿åºœæ‡‰è©²å…¨é¢ç¦æ­¢ï¼ã€</p></div>
                    <div id="choice-b" class="choice-card"><p class="font-bold">è©•è«– B</p><p class="text-stone-700 mt-2">ã€Œæ ¹æ“šç‰›æ´¥å¤§å­¸çš„ç ”ç©¶å ±å‘Šï¼ˆé™„é€£çµï¼‰ï¼ŒAI åœ¨é‡è¤‡æ€§é«˜çš„è·ä½ä¸Šå–ä»£æ€§è¼ƒå¼·ï¼Œä½†åœ¨éœ€è¦å‰µæ„èˆ‡åŒç†å¿ƒçš„é ˜åŸŸä»æœ‰ä¾·é™ã€‚æˆ‘èªç‚ºæˆ‘å€‘æ‡‰è©²å°ˆæ³¨æ–¼å¦‚ä½•èˆ‡ AI å”ä½œã€‚ã€</p></div>
                </div>
            </div>
            <div id="step-3" class="step-card text-center">
                <div class="text-5xl mb-4">ğŸ‰</div>
                <h2 class="text-3xl font-bold text-green-600 mb-4">ç²¾å½©çš„åˆ¤æ–·ï¼</h2>
                <p class="text-stone-700 text-lg mb-4">æ‚¨çš„é¸æ“‡èˆ‡ç¤¾ç¾¤ä¸­ 85% çš„é«˜ä¿¡ä»»åº¦ç”¨æˆ¶ä¸€è‡´ã€‚åœ¨é€™è£¡ï¼Œæˆ‘å€‘é‡è¦–çš„æ˜¯<strong class="text-sky-800">è­‰æ“š</strong>èˆ‡<strong class="text-sky-800">ç†æ€§</strong>ï¼Œè€Œéå–®ç´”çš„è²é‡ã€‚</p>
                <div class="bg-sky-50 p-4 rounded-lg">
                    <p class="font-bold">æŒ‡æ¨™åˆç™»å ´</p>
                    <p class="text-stone-600 mt-1">æ‚¨çš„<strong class="text-sky-800">æ·±åº¦å€¼</strong>å› æ­¤ç²å¾—äº†åˆå§‹åˆ†æ•¸ï¼Œç­‰ç´šç‚º <span class="font-mono bg-sky-200 text-sky-800 px-2 py-1 rounded">E</span>ã€‚é€™å€‹æŒ‡æ¨™ä»£è¡¨æ‚¨æ¢ç´¢ä¸åŒè§€é»çš„æ„é¡˜ã€‚</p>
                </div>
                <button data-next="step-4" class="next-btn mt-8 bg-sky-700 text-white font-bold py-3 px-8 rounded-full hover:bg-sky-800 transition-transform transform hover:scale-105">ç¹¼çºŒå­¸ç¿’</button>
            </div>
            <div id="step-4" class="step-card">
                <h2 class="text-2xl font-bold text-center mb-2">å­¸ç¿’æˆ‘å€‘çš„ã€Œè©•åƒ¹è§€é»ã€</h2>
                <div id="rating-context-container" class="mb-6 bg-stone-100 p-4 rounded-lg border-l-4 border-stone-300">
                    <p class="text-sm text-stone-500 mb-2">æƒ…å¢ƒï¼šé‡å°ä»¥ä¸‹é€™å‰‡**æœ‰è­‰æ“š**çš„è§€é»...</p>
                    <p class="font-bold">è©•è«– B</p>
                    <p class="text-stone-700 mt-1">ã€Œæ ¹æ“šç‰›æ´¥å¤§å­¸çš„ç ”ç©¶å ±å‘Šï¼ˆé™„é€£çµï¼‰ï¼ŒAI åœ¨é‡è¤‡æ€§é«˜çš„è·ä½ä¸Šå–ä»£æ€§è¼ƒå¼·ï¼Œä½†åœ¨éœ€è¦å‰µæ„èˆ‡åŒç†å¿ƒçš„é ˜åŸŸä»æœ‰ä¾·é™ã€‚æˆ‘èªç‚ºæˆ‘å€‘æ‡‰è©²å°ˆæ³¨æ–¼å¦‚ä½•èˆ‡ AI å”ä½œã€‚ã€</p>
                </div>
                <div id="rating-tutorial-container"></div>
            </div>
            <div id="step-5" class="step-card text-center">
                 <div class="text-5xl mb-4">ğŸŒŸ</div>
                <h2 class="text-3xl font-bold text-green-600 mb-4">å®Œç¾çš„è©•åƒ¹ï¼</h2>
                <p class="text-stone-700 text-lg mb-4">æ‚¨å‰›å‰›å®Œæˆäº†ä¸€æ¬¡é«˜å“è³ªçš„äº’å‹•ï¼š<strong class="text-sky-800">å³ä½¿èªåŒç«‹å ´ï¼Œä¹Ÿå®¢è§€æŒ‡å‡ºäº†å…¶è«–è¿°çš„ä¸è¶³ã€‚</strong></p>
                 <div class="bg-sky-50 p-4 rounded-lg">
                    <p class="font-bold">æŒ‡æ¨™ç™»å ´</p>
                    <p class="text-stone-600 mt-1">æ‚¨çš„<strong class="text-sky-800">ä¿¡ä»»å€¼</strong>å› æ­¤ç²å¾—äº†åˆå§‹åˆ†æ•¸ï¼Œç­‰ç´šç‚º <span class="font-mono bg-sky-200 text-sky-800 px-2 py-1 rounded">E</span>ã€‚å®ƒä»£è¡¨æ‚¨åˆ¤æ–·çš„å¯é ç¨‹åº¦ã€‚å¤šèŠ±é€™å…©ç§’é˜ï¼Œå°±æ˜¯å°ç¤¾ç¾¤æœ€æœ‰åŠ›çš„è²¢ç»ã€‚</p>
                </div>
                <button data-next="step-6" class="next-btn mt-8 bg-sky-700 text-white font-bold py-3 px-8 rounded-full hover:bg-sky-800 transition-transform transform hover:scale-105">æˆ‘æ˜ç™½äº†</button>
            </div>
            <div id="step-6" class="step-card">
                <h2 class="text-2xl font-bold text-center mb-8">èªè­˜æ‚¨çš„æ–°èº«ä»½</h2>
                <div class="bg-white p-6 rounded-lg shadow-inner border">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-stone-300 rounded-full"></div>
                        <div>
                            <p class="font-bold">ç”¨æˆ¶A</p>
                            <div class="flex items-center space-x-2 text-sm font-mono">
                                <span>ä¿¡: <span class="bg-green-100 text-green-800 px-2 py-0.5 rounded">A+ <span class="text-green-600">â†‘</span></span></span>
                                <span>æ·±: <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded">B <span class="text-gray-500">â”€</span></span></span>
                                <span>è²¢: <span class="bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded">S <span class="text-red-600">â†“</span></span></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 space-y-4 text-stone-700">
                    <p>åœ¨æœ¬å¹³å°ï¼Œæˆ‘å€‘ç”¨ <strong class="text-sky-800">SS, S, A, B, C...</strong> ç­‰ç´šä¾†ä»£è¡¨æ‚¨çš„å½±éŸ¿åŠ›ï¼Œè€Œéå†°å†·çš„æ•¸å­—ã€‚</p>
                    <p>æ‚¨çš„ç›®æ¨™æ˜¯æå‡<strong class="text-sky-800">å“è³ªå€é–“</strong>ï¼Œè€Œä¸æ˜¯è¿½æ±‚åˆ†æ•¸ç«¶è³½ã€‚</p>
                    <p>æ—é‚Šçš„ç®­é ­ <strong class="text-sky-800">â†‘ â”€ â†“</strong> ä»£è¡¨æ‚¨è¿‘æœŸçš„<strong class="text-sky-800">åŠªåŠ›è¶¨å‹¢</strong>ã€‚å³ä½¿ç­‰ç´šå°šæœªæå‡ï¼Œä¸€å€‹å‘ä¸Šçš„ç®­é ­ä¹Ÿè­‰æ˜æ‚¨çš„è²¢ç»æ­£è¢«çœ‹è¦‹ï¼</p>
                </div>
                <div class="text-center">
                    <button data-next="step-7" class="next-btn mt-8 bg-sky-700 text-white font-bold py-3 px-8 rounded-full hover:bg-sky-800 transition-transform transform hover:scale-105">é–‹å§‹æˆ‘çš„æ—…ç¨‹ï¼</button>
                </div>
            </div>
            <div id="step-7" class="step-card text-center">
                <h2 class="text-3xl md:text-4xl font-bold text-sky-900 mb-6">æ­å–œæ‚¨ï¼Œå·²å®Œæˆæ‰€æœ‰è¨“ç·´ã€‚</h2>
                <div class="space-y-4 text-lg text-stone-600">
                    <p>é€™å€‹å¹³å°çš„ä¿¡ä»»åº¦ï¼Œä¸æ˜¯ç”±æˆ‘å€‘æˆ– AI æ±ºå®šï¼Œè€Œæ˜¯ç”±ç¤¾ç¾¤ä¸­çš„æ¯ä¸€å€‹ã€Œæ‚¨ã€æ‰€å…±åŒå®šç¾©ã€‚</p>
                    <p>æ‚¨æ¯ä¸€æ¬¡<strong class="text-sky-800">ä¸é¡˜ç›²å¾çš„ã€å­˜ç–‘ã€‘</strong>ï¼Œæ¯ä¸€æ¬¡<strong class="text-sky-800">å®¢è§€çš„ã€å“è³ªè©•åƒ¹ã€‘</strong>ï¼Œéƒ½æ˜¯åœ¨ç‚ºé€™å€‹æ··äº‚çš„è³‡è¨Šç’°å¢ƒæ³¨å…¥ä¸€è‚¡æ¸…æµã€‚</p>
                    <p class="font-bold text-xl text-stone-800 mt-6">å› ç‚ºä½ æˆ‘çš„åŠªåŠ›ä¸æ‡¶æƒ°ï¼Œæ‰èƒ½è®“æ•´é«”çš„åª’é«”è­˜è®€èƒ½åŠ›æ›´ä¸Šä¸€å±¤æ¨“ã€‚</p>
                </div>
                 <button data-next="step-1" data-action="restart-tutorial" class="next-btn mt-10 bg-gray-600 text-white font-bold py-3 px-8 rounded-full hover:bg-gray-700 transition-transform transform hover:scale-105">é‡æ–°é–‹å§‹æ•™å­¸</button>
            </div>
        `;
        tutorialBackdrop.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»¾å‹•
        initializeTutorialLogic();
    }

    function closeTutorial() {
        tutorialBackdrop.style.display = 'none';
        document.body.style.overflow = '';
        onboardingFlowContainer.innerHTML = ''; // æ¸…ç©ºå…§å®¹ä»¥ä¾¿é‡ç½®
    }

    startTutorialBtn.addEventListener('click', startTutorial);
    closeTutorialBtn.addEventListener('click', closeTutorial);

    // --- æ•™å­¸å°è¦½çš„ç¨ç«‹ JS é‚è¼¯ (å¾ index2.html å®Œæ•´é‚„åŸ) ---
    function initializeTutorialLogic() {
        const onboardingFlow = document.getElementById('onboarding-flow');
        if (!onboardingFlow) return;

        const infoModal = document.getElementById('info-modal');
        const infoModalTitle = document.getElementById('info-modal-title');
        const infoModalBody = document.getElementById('info-modal-body');
        const infoModalFooter = document.getElementById('info-modal-footer');
        const contextMenu = document.getElementById('context-menu');
        const ratingMenu = document.getElementById('rating-menu');
        
        let ratingState = { stance: null, quality: [] };
        let currentTutorialIndex = 0;
        let longPressTimer = null;
        let longPressIndicatorEl = null;
        let menuJustOpened = false;

        const tutorialExamples = [
            { type: 'rate', text: "æˆ‘å®Œå…¨åŒæ„ B çš„çœ‹æ³•ï¼ŒAI çš„ç™¼å±•æ˜¯æ“‹ä¸ä½çš„è¶¨å‹¢ï¼Œèˆ‡å…¶ç¦æ­¢ä¸å¦‚å–„ç”¨å®ƒã€‚", instruction: "<strong>ç·´ç¿’1/4</strong>: è«‹<strong class='text-sky-800'>é•·æŒ‰</strong>é€™å‰‡è©•è«–ä¾†ã€è©•åƒ¹è§€é»ã€‘ã€‚å®ƒè¡¨é”äº†ç«‹å ´ï¼Œä½†æœ‰æå‡ºæ–°è­‰æ“šå—ï¼Ÿ", correct: { stance: 'èªåŒ', quality: ['- è­‰æ“šä¸è¶³'] } },
            { type: 'rate', text: "é€™ç¯‡æ–‡ç« çš„æ•¸æ“šæœ‰å•é¡Œï¼Œå®ƒå¼•ç”¨çš„å¸‚èª¿å ±å‘Šå·²ç¶“æ˜¯ä¸‰å¹´å‰çš„äº†ï¼Œå®Œå…¨ä¸èƒ½åæ˜ ç¾æ³ã€‚", instruction: "<strong>ç·´ç¿’2/4</strong>: é€™æ¬¡ï¼Œè«‹é»æ“Šå³ä¸‹è§’çš„<strong class='text-sky-800'>[...]æŒ‰éˆ•</strong>ï¼Œä¸¦é¸æ“‡ã€è©•åƒ¹è§€é»ã€‘ã€‚é€™å‰‡è©•è«–æå‡ºäº†å…·é«”çš„è³ªç–‘ã€‚", correct: { stance: 'å¦èª', quality: ['+ è­‰æ“šå……è¶³'] } },
            { type: 'rate-remove', text: "é€™å‰‡è©•è«–çš„è³‡è¨Šå¯èƒ½æœ‰èª¤ï¼Œæˆ‘å…ˆä¿ç•™çœ‹æ³•ã€‚", instruction: "<strong>ç·´ç¿’3/4</strong>: æœ‰æ™‚æˆ‘å€‘æœƒæ”¹è®Šå¿ƒæ„ã€‚è«‹å…ˆå°æ­¤è§€é»æŒ‰ã€å­˜ç–‘ã€‘ï¼Œç„¶å¾Œå†å¾<strong class='text-sky-800'>[...]æŒ‰éˆ•</strong>ä¸­ã€ç§»é™¤æˆ‘çš„è©•åƒ¹ã€‘ã€‚", correct: { stance: 'å­˜ç–‘', quality: [] } },
            { type: 'report', text: "æ¨“ä¸Šéƒ½æ˜¯ä¸€ç¾¤ä¸æ‡‚è£æ‡‚çš„ç™½ç—´ï¼Œæ ¹æœ¬æ²’è³‡æ ¼è¨è«–ã€‚", instruction: "<strong>ç·´ç¿’4/4</strong>: çœ‹åˆ°äººèº«æ”»æ“Šçš„è¨€è«–æ™‚ï¼Œæˆ‘å€‘å¯ä»¥ã€èˆ‰å ±å…§å®¹ã€‘ä¾†ç¶­è­·ç¤¾ç¾¤ã€‚è«‹å¾<strong class='text-sky-800'>[...]æŒ‰éˆ•</strong>ä¸­ç·´ç¿’èˆ‰å ±ã€‚" }
        ];

        const showStep = (stepId) => {
            const steps = onboardingFlow.querySelectorAll('.step-card');
            steps.forEach(step => step.classList.toggle('active', step.id === stepId));
            if (stepId === 'step-4') renderTutorialExample();
        };

        const showInfoModal = (config) => {
            const { title, bodyHtml, footerHtml, onclose } = config;
            infoModalTitle.textContent = title;
            infoModalBody.innerHTML = bodyHtml;
            infoModalFooter.innerHTML = footerHtml;
            infoModal.classList.add('active');
            
            const closeModal = () => {
                infoModal.classList.remove('active');
                if (onclose) onclose();
            };

            infoModal.querySelectorAll('button[data-action="close"]').forEach(btn => {
                btn.addEventListener('click', closeModal, { once: true });
            });
        };
        
        const showFloodingEffect = () => {
            showInfoModal({
                title: 'å—¯...é€™å€‹é¸æ“‡æœƒè®“ä¸–ç•Œè®Šå¾—æ›´æ··äº‚å–”',
                bodyHtml: `<p>ç•¶æˆ‘å€‘èªåŒæƒ…ç·’åŒ–çš„è¨€è«–æ™‚ï¼Œæˆ‘å€‘çš„ä¸–ç•Œå°±å®¹æ˜“è¢«æ›´å¤šç›¸ä¼¼çš„è²éŸ³æ·¹æ²’ã€‚</p><p>ä¸€å€‹ç†æ€§çš„ç¤¾ç¾¤ï¼Œéœ€è¦æˆ‘å€‘ä¸€èµ·åˆ†è¾¨è³‡è¨Šçš„å“è³ªã€‚</p><p class="font-bold mt-4">æ‚¨æƒ³æ‰“é€ ä¸€å€‹æ€æ¨£çš„ç¤¾ç¾¤ï¼Ÿ</p>`,
                footerHtml: `<button data-action="close" class="bg-sky-700 text-white font-bold py-2 px-6 rounded-full hover:bg-sky-800 transition">ä¸€å€‹ç†æ€§çš„è¨è«–ç©ºé–“</button>`,
                onclose: () => {
                    showInfoModal({
                        title: 'å¾ˆæ£’çš„é¸æ“‡ï¼',
                        bodyHtml: 'è®“æˆ‘å€‘ä¸€èµ·ç‚ºç†æ€§çš„è¨è«–ç©ºé–“åŠªåŠ›ã€‚è«‹æ‚¨é‡æ–°é¸æ“‡æ›´æœ‰åƒè€ƒåƒ¹å€¼çš„è©•è«–ã€‚',
                        footerHtml: `<button data-action="close" class="bg-sky-700 text-white font-bold py-2 px-6 rounded-full hover:bg-sky-800 transition">å¥½çš„</button>`
                    });
                }
            });
            
            setTimeout(() => {
                const floodMessages = ['éƒ½æ˜¯é¨™äººçš„ï¼', 'è²¡åœ˜çš„æ‰“æ‰‹ï¼', 'å»¢æ–‡ä¸€ç¯‡', 'å°ç·¨å·¥è®€ç”Ÿï¼Ÿ', 'å¸¶é¢¨å‘ï¼'];
                const modalBodyRect = infoModalBody.getBoundingClientRect();
                if (modalBodyRect.width === 0 || modalBodyRect.height === 0) return;

                for (let i = 0; i < 5; i++) {
                    const floodEl = document.createElement('div');
                    floodEl.className = 'flooding-comment';
                    floodEl.textContent = floodMessages[Math.floor(Math.random() * floodMessages.length)];
                    
                    const top = Math.random() * (modalBodyRect.height - 40);
                    const left = Math.random() * (modalBodyRect.width - 120);
                    floodEl.style.top = `${top}px`;
                    floodEl.style.left = `${left}px`;
                    floodEl.style.animationDelay = `${i * 0.3}s`;
                    infoModalBody.appendChild(floodEl);
                }
            }, 100);
        };

        const renderTutorialExample = () => {
            ratingState = { stance: null, quality: [] };
            const example = tutorialExamples[currentTutorialIndex];
            const ratingTutorialContainer = document.getElementById('rating-tutorial-container');
            if (!ratingTutorialContainer) return;
            const ratedCheckmark = example.rated ? `<div class="absolute top-2 right-2 text-green-500 text-2xl">âœ“</div>` : '';

            const html = `
                <p class="text-center text-stone-500 mb-4">${example.instruction}</p>
                <div id="rating-card-container" class="relative">
                    <div id="rating-card" class="choice-card bg-stone-50 relative">
                        <div class="long-press-indicator"></div>
                        <p class="text-stone-700 mt-2">${example.text}</p>
                        ${ratedCheckmark}
                        <div class="absolute bottom-2 right-3">
                            <button class="more-options-btn text-stone-400 hover:text-stone-700 font-bold text-2xl leading-none">...</button>
                        </div>
                    </div>
                </div>`;
            ratingTutorialContainer.innerHTML = html;
            addTutorialListeners();
        };

        const addTutorialListeners = () => {
            const ratingCard = document.getElementById('rating-card');
            if (!ratingCard) return;
            const moreOptionsBtn = ratingCard.querySelector('.more-options-btn');
            longPressIndicatorEl = ratingCard.querySelector('.long-press-indicator');

            const startPress = (e) => {
                e.preventDefault();
                if (longPressTimer !== null) return;
                longPressIndicatorEl.classList.add('pressing');
                const duration = 500;
                let startTime = null;
                const animateProgress = (timestamp) => {
                    if (!startTime) startTime = timestamp;
                    const elapsed = timestamp - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const angle = -90 + (360 * progress);
                    if(longPressIndicatorEl) longPressIndicatorEl.style.setProperty('--angle', `${angle}deg`);
                    if (progress < 1 && longPressTimer) requestAnimationFrame(animateProgress);
                };
                requestAnimationFrame(animateProgress);
                longPressTimer = setTimeout(() => {
                    triggerMenu('rating', ratingCard);
                    cancelPress();
                }, duration);
            };

            const cancelPress = () => {
                clearTimeout(longPressTimer);
                longPressTimer = null;
                if (longPressIndicatorEl) {
                    longPressIndicatorEl.classList.remove('pressing');
                    longPressIndicatorEl.style.setProperty('--angle', '-90deg');
                }
            };

            ratingCard.addEventListener('mousedown', startPress);
            ratingCard.addEventListener('mouseup', cancelPress);
            ratingCard.addEventListener('mouseleave', cancelPress);
            ratingCard.addEventListener('touchstart', startPress, { passive: false });
            ratingCard.addEventListener('touchend', cancelPress);
            ratingCard.addEventListener('touchcancel', cancelPress);
            moreOptionsBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                triggerMenu('context', moreOptionsBtn);
            });
        };

        const triggerMenu = (type, targetElement) => {
            const menu = (type === 'context') ? contextMenu : ratingMenu;
            const rect = targetElement.getBoundingClientRect();
            if (type === 'context') {
                menu.style.top = `${rect.top}px`;
                menu.style.left = `${rect.left}px`;
                menu.style.transform = `translate(-100%, -100%)`;
            } else {
                menu.style.top = `${rect.top + rect.height / 2}px`;
                menu.style.left = `${rect.left + rect.width / 2}px`;
                menu.style.transform = `translate(-50%, -50%)`;
            }
            if (type === 'rating') renderRatingMenu();
            menu.classList.add('active');
            menuJustOpened = true;
        };

        const hideAllMenus = () => {
            contextMenu.classList.remove('active');
            ratingMenu.classList.remove('active');
        };

        const renderRatingMenu = () => {
            let stanceHtml = `<div class="flex justify-around border-b border-stone-200 pb-2 mb-2">
                <div class="menu-btn rating-btn stance-btn ${ratingState.stance === 'èªåŒ' ? 'selected' : ''}" data-value="èªåŒ">ğŸ˜Š èªåŒ</div>
                <div class="menu-btn rating-btn stance-btn ${ratingState.stance === 'å­˜ç–‘' ? 'selected' : ''}" data-value="å­˜ç–‘">ğŸ˜ å­˜ç–‘</div>
                <div class="menu-btn rating-btn stance-btn ${ratingState.stance === 'å¦èª' ? 'selected' : ''}" data-value="å¦èª">ğŸ˜  å¦èª</div></div>`;
            let qualityHtml = '';
            if (ratingState.stance) {
                const tags = ['+ è­‰æ“šå……è¶³', '+ é‚è¼¯æ¸…æ™°', '- è¨´è«¸æƒ…æ„Ÿ', '- è­‰æ“šä¸è¶³'];
                qualityHtml = `<div class="grid grid-cols-2 gap-2">
                    ${tags.map(tag => `<div class="tag-btn quality-btn ${ratingState.quality.includes(tag) ? 'selected' : ''}" data-value="${tag}">${tag}</div>`).join('')}
                    </div><button id="complete-rating" class="w-full mt-2 bg-sky-600 text-white rounded-lg py-2 menu-btn">å®Œæˆ</button>`;
            }
            ratingMenu.innerHTML = stanceHtml + qualityHtml;
        };
        
        const completeRating = () => {
            const example = tutorialExamples[currentTutorialIndex];
            if (!example || !example.correct) {
                hideAllMenus();
                showInfoModal({
                    title: 'æç¤º',
                    bodyHtml: 'é€™å€‹ç·´ç¿’çš„ç›®æ¨™æ˜¯å­¸ç¿’ã€èˆ‰å ±å…§å®¹ã€‘ï¼Œè«‹å¾ [...] é¸å–®ä¸­é¸æ“‡å–”ï¼',
                    footerHtml: `<button data-action="close" class="bg-sky-700 text-white font-bold py-2 px-6 rounded-full hover:bg-sky-800">å¥½çš„</button>`
                });
                return;
            }

            const isCorrect = ratingState.stance === example.correct.stance && 
                              (example.correct.quality.length === 0 ||
                              (ratingState.quality.length === example.correct.quality.length &&
                               example.correct.quality.every(q => ratingState.quality.includes(q))));

            if (isCorrect) {
                hideAllMenus();
                if (example.type === 'rate-remove' && !example.rated) {
                    example.rated = true;
                    renderTutorialExample();
                    return;
                }
                currentTutorialIndex++;
                if (currentTutorialIndex >= tutorialExamples.length) {
                     showInfoModal({
                        title: 'ç·´ç¿’å®Œæˆï¼',
                        bodyHtml: 'æ‚¨å·²ç†Ÿæ‚‰æ‰€æœ‰åŸºæœ¬çš„è©•åƒ¹æ“ä½œï¼',
                        footerHtml: `<button data-action="close" class="bg-sky-700 text-white font-bold py-2 px-6 rounded-full hover:bg-sky-800">ç¹¼çºŒ</button>`,
                        onclose: () => showStep('step-5')
                    });
                } else {
                    renderTutorialExample();
                }
            } else {
                const correctStance = example.correct.stance;
                const correctQuality = example.correct.quality.join('ã€');
                let bodyHtml = `é€™å€‹ç·´ç¿’çš„ç›®æ¨™æ˜¯å­¸ç¿’åˆ¤æ–·å…§å®¹çš„å“è³ªã€‚è«‹è©¦è‘—é¸æ“‡ã€${correctStance}ã€‘`;
                if (correctQuality) bodyHtml += `ï¼Œä¸¦ç‚ºå®ƒåŠ ä¸Šã€${correctQuality}ã€‘çš„æ¨™ç±¤ã€‚`;
                else bodyHtml += `ã€‚`;
                showInfoModal({
                    title: 'å†è©¦ä¸€æ¬¡ï¼', bodyHtml,
                    footerHtml: `<button data-action="close" class="bg-sky-700 text-white font-bold py-2 px-6 rounded-full hover:bg-sky-800">å¥½çš„ï¼Œå†è©¦ä¸€æ¬¡</button>`
                });
            }
        };

        onboardingFlow.addEventListener('click', (e) => {
            const nextBtn = e.target.closest('.next-btn');
            if (nextBtn) {
                const nextStepId = nextBtn.dataset.next;
                if (nextBtn.dataset.action === 'restart-tutorial') {
                    // é‡ç½®æ•™å­¸ç‹€æ…‹
                    const choiceB = document.getElementById('choice-b');
                    if(choiceB) choiceB.classList.remove('selected');
                    currentTutorialIndex = 0;
                    tutorialExamples.forEach(ex => ex.rated = false);
                }
                showStep(nextStepId);
                return;
            }

            const choiceA = e.target.closest('#choice-a');
            if (choiceA) {
                 showFloodingEffect();
                 return;
            }
            const choiceB = e.target.closest('#choice-b');
            if (choiceB) {
                choiceB.classList.add('selected');
                setTimeout(() => showStep('step-3'), 800);
                return;
            }
        });

        document.addEventListener('click', (e) => {
            if (menuJustOpened) {
                menuJustOpened = false;
                return;
            }
            if (!contextMenu.contains(e.target) && !ratingMenu.contains(e.target) && !e.target.closest('.more-options-btn')) {
                hideAllMenus();
            }
            const target = e.target.closest('.menu-btn, .quality-btn');
            if (!target) return;
            e.stopPropagation();

            if (contextMenu.contains(target)) {
                const action = target.dataset.action;
                hideAllMenus();
                if (action === 'rate') {
                    triggerMenu('rating', document.getElementById('rating-card'));
                } else if (action === 'report') {
                     const example = tutorialExamples[currentTutorialIndex];
                     if (example.type === 'report') {
                        showInfoModal({
                            title: 'ç¢ºèªèˆ‰å ±ï¼Ÿ',
                            bodyHtml: 'æ‚¨ç¢ºå®šè¦èˆ‰å ±æ­¤å…§å®¹é•åç¤¾ç¾¤è¦ç¯„å—ï¼Ÿ',
                            footerHtml: `<button id="confirm-report-btn" data-action="close" class="bg-red-600 text-white font-bold py-2 px-6 rounded-full hover:bg-red-700">ç¢ºèªèˆ‰å ±</button>
                                         <button data-action="close" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-full hover:bg-gray-300">å–æ¶ˆ</button>`,
                        });
                        document.getElementById('confirm-report-btn').addEventListener('click', () => {
                            showInfoModal({
                               title: 'æ„Ÿè¬æ‚¨çš„èˆ‰å ±',
                               bodyHtml: 'æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„å›å ±ã€‚æ„Ÿè¬æ‚¨ä¸€åŒç¶­è­·ç¤¾ç¾¤çš„å¥åº·ç’°å¢ƒï¼',
                               footerHtml: `<button data-action="close" class="bg-sky-700 text-white font-bold py-2 px-6 rounded-full hover:bg-sky-800">å®Œæˆæ‰€æœ‰ç·´ç¿’</button>`,
                               onclose: () => showStep('step-5')
                            });
                        }, { once: true });
                     } else {
                         showInfoModal({ title: 'æç¤º', bodyHtml: 'é€™å‰‡å…§å®¹ä¼¼ä¹æ²’æœ‰é•åç¤¾ç¾¤è¦ç¯„ï¼Œè«‹å…ˆç·´ç¿’å…¶ä»–æ“ä½œå–”ï¼', footerHtml: `<button data-action="close" class="bg-sky-700 text-white font-bold py-2 px-6 rounded-full hover:bg-sky-800">å¥½çš„</button>` });
                     }
                } else if (action === 'remove') {
                     const example = tutorialExamples[currentTutorialIndex];
                     if (example.type === 'rate-remove' && example.rated) {
                        showInfoModal({
                            title: 'ç¢ºèªç§»é™¤ï¼Ÿ',
                            bodyHtml: 'æ‚¨ç¢ºå®šè¦ç§»é™¤æ‚¨çš„è©•åƒ¹å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
                            footerHtml: `<button id="confirm-remove-btn" data-action="close" class="bg-red-600 text-white font-bold py-2 px-6 rounded-full hover:bg-red-700">ç¢ºèªç§»é™¤</button>
                                         <button data-action="close" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-full hover:bg-gray-300">å–æ¶ˆ</button>`,
                        });
                        document.getElementById('confirm-remove-btn').addEventListener('click', () => {
                            currentTutorialIndex++;
                            renderTutorialExample();
                        }, { once: true });
                     } else {
                         showInfoModal({ title: 'æç¤º', bodyHtml: 'æ‚¨å°šæœªå°æ­¤è§€é»åšå‡ºè©•åƒ¹ï¼Œæˆ–ç¾åœ¨ä¸æ˜¯ç§»é™¤è©•åƒ¹çš„ç·´ç¿’æ­¥é©Ÿå–”ã€‚', footerHtml: `<button data-action="close" class="bg-sky-700 text-white font-bold py-2 px-6 rounded-full hover:bg-sky-800">å¥½çš„</button>` });
                     }
                }
            }

            if (ratingMenu.contains(target)) {
                if (target.matches('.stance-btn')) {
                    ratingState.stance = target.dataset.value;
                    if (tutorialExamples[currentTutorialIndex].type === 'rate-remove' && !tutorialExamples[currentTutorialIndex].rated) {
                        completeRating();
                    } else {
                        renderRatingMenu();
                    }
                } else if (target.matches('.quality-btn')) {
                    const value = target.dataset.value;
                    const index = ratingState.quality.indexOf(value);
                    if (index > -1) ratingState.quality.splice(index, 1);
                    else ratingState.quality.push(value);
                    renderRatingMenu();
                } else if (target.id === 'complete-rating') {
                    completeRating();
                }
            }
        });
    }
});
</script>
</body>
</html>
